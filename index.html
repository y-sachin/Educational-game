<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Game - Educational Gaming App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;600;700&family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans Devanagari', 'Inter', sans-serif;
        }
        
        .game-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientFlow 15s ease infinite;
        }
        
        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }
        
        .card-3d {
            transform-style: preserve-3d;
            transition: all 0.4s ease;
        }
        
        .card-3d:hover {
            transform: rotateY(10deg) rotateX(5deg) translateY(-10px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }
        
        .bounce-scale {
            animation: bounceScale 0.6s ease-out;
        }
        
        @keyframes bounceScale {
            0% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(2deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .glow-effect {
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); }
            to { box-shadow: 0 0 40px rgba(255, 255, 255, 0.5); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .celebration {
            animation: celebration 1s ease-out;
        }
        
        @keyframes celebration {
            0% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.2) rotate(5deg); }
            50% { transform: scale(1.1) rotate(-3deg); }
            75% { transform: scale(1.15) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .hidden { display: none; }
        .game-button {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border: 2px solid transparent;
            background-clip: padding-box;
            transition: all 0.3s ease;
        }
        
        .game-button:hover {
            background: linear-gradient(145deg, #f0f0f0, #e0e0e0);
            transform: translateY(-2px);
        }
        
        .correct-answer {
            background: linear-gradient(145deg, #10b981, #059669) !important;
            color: white !important;
        }
        
        .wrong-answer {
            background: linear-gradient(145deg, #ef4444, #dc2626) !important;
            color: white !important;
        }
    </style>
</head>
<body class="game-gradient min-h-screen">
    <!-- Header -->
    <header class="bg-white/10 backdrop-blur-md border-b border-white/20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="text-4xl">üéÆ</div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">Educational Game</h1>
                        <p class="text-white/80 text-sm">‡§ñ‡•á‡§≤ ‡§ñ‡•á‡§≤ ‡§Æ‡•á‡§Ç ‡§∏‡•Ä‡§ñ‡•á‡§Ç</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- User Stats (shown when logged in) -->
                    <div id="user-stats" class="flex items-center space-x-4 hidden">
                        <div class="bg-white/20 rounded-full px-4 py-2 glow-effect">
                            <span class="text-white font-bold">üèÜ <span id="totalCoins">0</span></span>
                        </div>
                        <div class="bg-white/20 rounded-full px-4 py-2">
                            <span class="text-white font-bold">‚≠ê Level <span id="playerLevel">1</span></span>
                        </div>
                        <div class="bg-white/20 rounded-full px-4 py-2">
                            <span class="text-white font-bold">üî• <span id="streakCount">0</span></span>
                        </div>
                        <!-- User Profile Dropdown -->
                        <div class="relative">
                            <button id="user-menu-btn" class="flex items-center space-x-2 bg-white/20 rounded-full px-4 py-2 hover:bg-white/30 transition-colors">
                                <div class="w-8 h-8 rounded-full overflow-hidden flex items-center justify-center bg-white/20" id="user-avatar-container">
                                    <div class="text-2xl" id="user-avatar">üë§</div>
                                </div>
                                <span class="text-white font-semibold" id="user-display-name">Player</span>
                                <div class="text-white">‚ñº</div>
                            </button>
                            <div id="user-dropdown" class="absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg hidden z-50 max-h-96 overflow-y-auto">
                                <div class="py-2">
                                    <!-- Current User Section -->
                                    <div class="px-4 py-2 bg-blue-50 border-b">
                                        <div class="text-sm text-blue-600 font-semibold">Current User</div>
                                        <div class="flex items-center space-x-2 mt-1">
                                            <div class="w-6 h-6 rounded-full overflow-hidden flex items-center justify-center bg-gray-100" id="dropdown-user-avatar-container">
                                                <span id="dropdown-user-avatar">üë§</span>
                                            </div>
                                            <span class="font-semibold text-gray-800" id="dropdown-user-name">Player</span>
                                        </div>
                                    </div>
                                    
                                    <!-- User Actions -->
                                    <button class="w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors" onclick="showSection('profile')">
                                        üë§ Profile
                                    </button>
                                    <button class="w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors" onclick="showSection('achievements')">
                                        üèÜ Achievements
                                    </button>
                                    <button class="w-full text-left px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors" onclick="showSettings()">
                                        ‚öôÔ∏è Settings
                                    </button>
                                    
                                    <hr class="my-1">
                                    
                                    <!-- Switch User Section -->
                                    <div class="px-4 py-2 bg-green-50">
                                        <div class="text-sm text-green-600 font-semibold mb-2">Switch User</div>
                                        <div id="other-users-list" class="space-y-1 max-h-32 overflow-y-auto">
                                            <!-- Other users will be populated here -->
                                        </div>
                                        <button class="w-full text-left text-green-600 hover:text-green-800 text-sm font-semibold mt-2" onclick="showAddUserOption()">
                                            ‚ûï Add New User
                                        </button>
                                    </div>
                                    
                                    <hr class="my-1">
                                    
                                    <!-- User Management -->
                                    <button class="w-full text-left px-4 py-2 text-blue-600 hover:bg-blue-50 transition-colors" onclick="showUserManager()">
                                        üë• Manage Users
                                    </button>
                                    <button class="w-full text-left px-4 py-2 text-gray-600 hover:bg-gray-50 transition-colors" onclick="showDeviceInfo()">
                                        üì± Device Info
                                    </button>
                                    <button class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 transition-colors" onclick="logout()">
                                        üö™ Logout
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Login/Register Buttons (shown when not logged in) -->
                    <div id="auth-buttons" class="flex items-center space-x-3">
                        <button class="bg-white/20 text-white px-6 py-2 rounded-full font-semibold hover:bg-white/30 transition-colors" onclick="showLogin()">
                            üîë Login
                        </button>
                        <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-full font-semibold hover:from-blue-600 hover:to-purple-600 transition-all" onclick="showRegister()">
                            ‚ú® Register
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white/10 backdrop-blur-md border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex space-x-1 overflow-x-auto">
                <button class="nav-btn bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-t-lg font-semibold" onclick="showSection('home')">
                    üè† Home
                </button>
                <button class="nav-btn bg-white/10 text-white px-6 py-3 rounded-t-lg font-semibold" onclick="showSection('subjects')">
                    üìö Subjects
                </button>
                <button class="nav-btn bg-white/10 text-white px-6 py-3 rounded-t-lg font-semibold" onclick="showSection('games')">
                    üéØ Games
                </button>
                <button class="nav-btn bg-white/10 text-white px-6 py-3 rounded-t-lg font-semibold" onclick="showSection('achievements')">
                    üèÜ Achievements
                </button>
                <button class="nav-btn bg-white/10 text-white px-6 py-3 rounded-t-lg font-semibold" onclick="showSection('leaderboard')">
                    üèÖ Leaderboard
                </button>
                <button class="nav-btn bg-white/10 text-white px-6 py-3 rounded-t-lg font-semibold" onclick="showSection('profile')">
                    üë§ Profile
                </button>
            </div>
        </div>
    </nav>

    <!-- Update Notification Bar -->
    <div id="update-notification" class="fixed top-0 left-0 right-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 z-50 hidden transform -translate-y-full transition-transform duration-500">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="text-2xl">üöÄ</div>
                <div>
                    <div class="font-bold">New Update Available!</div>
                    <div class="text-sm opacity-90" id="update-version-info">Version 1.1.0 with exciting new features</div>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <button class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-semibold transition-colors" onclick="showUpdateDetails()">
                    üìã Details
                </button>
                <button class="bg-white text-blue-600 hover:bg-gray-100 px-4 py-2 rounded-lg font-semibold transition-colors" onclick="startUpdate()">
                    ‚¨áÔ∏è Update Now
                </button>
                <button class="text-white/80 hover:text-white p-2" onclick="dismissUpdateNotification()">
                    ‚úï
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8 transition-all duration-500" id="main-content">
        
        <!-- Home Section -->
        <section id="home" class="section bounce-scale">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-white mb-4">üéÆ Welcome to Educational Game!</h2>
                <p class="text-xl text-white/90 mb-8">‡§ñ‡•á‡§≤ ‡§ñ‡•á‡§≤ ‡§Æ‡•á‡§Ç ‡§∏‡•Ä‡§ñ‡•á‡§Ç ‡§î‡§∞ ‡§Æ‡§ú‡•á ‡§ï‡§∞‡•á‡§Ç</p>
                
                <!-- Quick Stats -->
                <div class="grid md:grid-cols-4 gap-6 mb-12">
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                        <div class="text-4xl mb-2">üéØ</div>
                        <div class="text-2xl font-bold text-gray-800" id="gamesPlayed">0</div>
                        <div class="text-gray-600">Games Played</div>
                    </div>
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                        <div class="text-4xl mb-2">‚úÖ</div>
                        <div class="text-2xl font-bold text-green-600" id="correctAnswers">0</div>
                        <div class="text-gray-600">Correct Answers</div>
                    </div>
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                        <div class="text-4xl mb-2">üìä</div>
                        <div class="text-2xl font-bold text-blue-600" id="accuracyRate">0%</div>
                        <div class="text-gray-600">Accuracy</div>
                    </div>
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                        <div class="text-4xl mb-2">üèÜ</div>
                        <div class="text-2xl font-bold text-purple-600" id="totalBadges">0</div>
                        <div class="text-gray-600">Badges Earned</div>
                    </div>
                </div>

                <!-- Featured Games -->
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d cursor-pointer" onclick="startQuickGame('math')">
                        <div class="text-5xl mb-4">üßÆ</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Math Challenge</h3>
                        <p class="text-gray-600 mb-4">Quick math problems to boost your skills</p>
                        <button class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all">
                            Play Now
                        </button>
                    </div>
                    
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d cursor-pointer" onclick="startQuickGame('science')">
                        <div class="text-5xl mb-4">üî¨</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Science Quiz</h3>
                        <p class="text-gray-600 mb-4">Explore the wonders of science</p>
                        <button class="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition-all">
                            Play Now
                        </button>
                    </div>
                    
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d cursor-pointer" onclick="startQuickGame('english')">
                        <div class="text-5xl mb-4">üìù</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Word Master</h3>
                        <p class="text-gray-600 mb-4">Improve your vocabulary and grammar</p>
                        <button class="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-rose-600 transition-all">
                            Play Now
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Subjects Section -->
        <section id="subjects" class="section hidden">
            <h2 class="text-3xl font-bold text-white text-center mb-8">üìö Choose Your Subject</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Math -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-6xl mb-4 text-center">üßÆ</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Mathematics</h3>
                    <p class="text-gray-600 mb-4">Arithmetic, Algebra, Geometry ‡§î‡§∞ ‡§¨‡§π‡•Å‡§§ ‡§ï‡•Å‡§õ</p>
                    <div class="space-y-2 mb-4">
                        <button class="w-full bg-blue-100 text-blue-800 py-2 rounded-lg font-semibold hover:bg-blue-200 transition-colors" onclick="startSubjectGame('math', 'basic')">
                            Basic Math
                        </button>
                        <button class="w-full bg-blue-200 text-blue-800 py-2 rounded-lg font-semibold hover:bg-blue-300 transition-colors" onclick="startSubjectGame('math', 'intermediate')">
                            Intermediate
                        </button>
                        <button class="w-full bg-blue-300 text-blue-800 py-2 rounded-lg font-semibold hover:bg-blue-400 transition-colors" onclick="startSubjectGame('math', 'advanced')">
                            Advanced
                        </button>
                    </div>
                </div>

                <!-- Science -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-6xl mb-4 text-center">üî¨</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Science</h3>
                    <p class="text-gray-600 mb-4">Physics, Chemistry, Biology ‡§ï‡•á concepts</p>
                    <div class="space-y-2 mb-4">
                        <button class="w-full bg-green-100 text-green-800 py-2 rounded-lg font-semibold hover:bg-green-200 transition-colors" onclick="startSubjectGame('science', 'physics')">
                            Physics
                        </button>
                        <button class="w-full bg-green-200 text-green-800 py-2 rounded-lg font-semibold hover:bg-green-300 transition-colors" onclick="startSubjectGame('science', 'chemistry')">
                            Chemistry
                        </button>
                        <button class="w-full bg-green-300 text-green-800 py-2 rounded-lg font-semibold hover:bg-green-400 transition-colors" onclick="startSubjectGame('science', 'biology')">
                            Biology
                        </button>
                    </div>
                </div>

                <!-- English -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-6xl mb-4 text-center">üìù</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">English</h3>
                    <p class="text-gray-600 mb-4">Grammar, Vocabulary, Reading skills</p>
                    <div class="space-y-2 mb-4">
                        <button class="w-full bg-pink-100 text-pink-800 py-2 rounded-lg font-semibold hover:bg-pink-200 transition-colors" onclick="startSubjectGame('english', 'vocabulary')">
                            Vocabulary
                        </button>
                        <button class="w-full bg-pink-200 text-pink-800 py-2 rounded-lg font-semibold hover:bg-pink-300 transition-colors" onclick="startSubjectGame('english', 'grammar')">
                            Grammar
                        </button>
                        <button class="w-full bg-pink-300 text-pink-800 py-2 rounded-lg font-semibold hover:bg-pink-400 transition-colors" onclick="startSubjectGame('english', 'reading')">
                            Reading
                        </button>
                    </div>
                </div>

                <!-- History -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-6xl mb-4 text-center">üèõÔ∏è</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">History</h3>
                    <p class="text-gray-600 mb-4">World History, Indian History, Events</p>
                    <div class="space-y-2 mb-4">
                        <button class="w-full bg-yellow-100 text-yellow-800 py-2 rounded-lg font-semibold hover:bg-yellow-200 transition-colors" onclick="startSubjectGame('history', 'world')">
                            World History
                        </button>
                        <button class="w-full bg-yellow-200 text-yellow-800 py-2 rounded-lg font-semibold hover:bg-yellow-300 transition-colors" onclick="startSubjectGame('history', 'indian')">
                            Indian History
                        </button>
                        <button class="w-full bg-yellow-300 text-yellow-800 py-2 rounded-lg font-semibold hover:bg-yellow-400 transition-colors" onclick="startSubjectGame('history', 'modern')">
                            Modern History
                        </button>
                    </div>
                </div>

                <!-- Geography -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-6xl mb-4 text-center">üåç</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Geography</h3>
                    <p class="text-gray-600 mb-4">Countries, Capitals, Rivers, Mountains</p>
                    <div class="space-y-2 mb-4">
                        <button class="w-full bg-teal-100 text-teal-800 py-2 rounded-lg font-semibold hover:bg-teal-200 transition-colors" onclick="startSubjectGame('geography', 'countries')">
                            Countries & Capitals
                        </button>
                        <button class="w-full bg-teal-200 text-teal-800 py-2 rounded-lg font-semibold hover:bg-teal-300 transition-colors" onclick="startSubjectGame('geography', 'physical')">
                            Physical Geography
                        </button>
                        <button class="w-full bg-teal-300 text-teal-800 py-2 rounded-lg font-semibold hover:bg-teal-400 transition-colors" onclick="startSubjectGame('geography', 'indian')">
                            Indian Geography
                        </button>
                    </div>
                </div>

                <!-- General Knowledge -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-6xl mb-4 text-center">üß†</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">General Knowledge</h3>
                    <p class="text-gray-600 mb-4">Current Affairs, Sports, Technology</p>
                    <div class="space-y-2 mb-4">
                        <button class="w-full bg-purple-100 text-purple-800 py-2 rounded-lg font-semibold hover:bg-purple-200 transition-colors" onclick="startSubjectGame('gk', 'current')">
                            Current Affairs
                        </button>
                        <button class="w-full bg-purple-200 text-purple-800 py-2 rounded-lg font-semibold hover:bg-purple-300 transition-colors" onclick="startSubjectGame('gk', 'sports')">
                            Sports
                        </button>
                        <button class="w-full bg-purple-300 text-purple-800 py-2 rounded-lg font-semibold hover:bg-purple-400 transition-colors" onclick="startSubjectGame('gk', 'tech')">
                            Technology
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Games Section -->
        <section id="games" class="section hidden">
            <h2 class="text-3xl font-bold text-white text-center mb-8">üéØ Educational Games</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Quick Quiz -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">‚ö°</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Quick Quiz</h3>
                    <p class="text-gray-600 mb-4">5 questions, 30 seconds each</p>
                    <button class="w-full bg-gradient-to-r from-yellow-500 to-orange-500 text-white py-3 rounded-lg font-semibold hover:from-yellow-600 hover:to-orange-600 transition-all" onclick="startGameMode('quick')">
                        Start Quick Quiz
                    </button>
                </div>

                <!-- Marathon Mode -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">üèÉ</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Marathon Mode</h3>
                    <p class="text-gray-600 mb-4">20 questions, test your endurance</p>
                    <button class="w-full bg-gradient-to-r from-red-500 to-pink-500 text-white py-3 rounded-lg font-semibold hover:from-red-600 hover:to-pink-600 transition-all" onclick="startGameMode('marathon')">
                        Start Marathon
                    </button>
                </div>

                <!-- Time Attack -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">‚è∞</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Time Attack</h3>
                    <p class="text-gray-600 mb-4">Answer as many as you can in 2 minutes</p>
                    <button class="w-full bg-gradient-to-r from-indigo-500 to-purple-500 text-white py-3 rounded-lg font-semibold hover:from-indigo-600 hover:to-purple-600 transition-all" onclick="startGameMode('timeattack')">
                        Start Time Attack
                    </button>
                </div>

                <!-- Survival Mode -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">üíÄ</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Survival Mode</h3>
                    <p class="text-gray-600 mb-4">One wrong answer and you're out!</p>
                    <button class="w-full bg-gradient-to-r from-gray-700 to-gray-900 text-white py-3 rounded-lg font-semibold hover:from-gray-800 hover:to-black transition-all" onclick="startGameMode('survival')">
                        Start Survival
                    </button>
                </div>

                <!-- Memory Game -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">üß©</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Memory Challenge</h3>
                    <p class="text-gray-600 mb-4">Remember and match educational content</p>
                    <button class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 text-white py-3 rounded-lg font-semibold hover:from-cyan-600 hover:to-blue-600 transition-all" onclick="startGameMode('memory')">
                        Start Memory Game
                    </button>
                </div>

                <!-- Puzzle Mode -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">üß©</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Puzzle Solver</h3>
                    <p class="text-gray-600 mb-4">Solve educational puzzles and riddles</p>
                    <button class="w-full bg-gradient-to-r from-emerald-500 to-teal-500 text-white py-3 rounded-lg font-semibold hover:from-emerald-600 hover:to-teal-600 transition-all" onclick="startGameMode('puzzle')">
                        Start Puzzle
                    </button>
                </div>

                <!-- Infinite Mode -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">‚ôæÔ∏è</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Infinite Mode</h3>
                    <p class="text-gray-600 mb-4">Never-ending questions! Play as long as you want</p>
                    <button class="w-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-indigo-600 transition-all" onclick="startGameMode('infinite')">
                        Start Infinite
                    </button>
                </div>

                <!-- Practice Mode -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 card-3d">
                    <div class="text-5xl mb-4 text-center">üìö</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">Practice Mode</h3>
                    <p class="text-gray-600 mb-4">No time pressure, learn at your own pace</p>
                    <button class="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-emerald-600 transition-all" onclick="startGameMode('practice')">
                        Start Practice
                    </button>
                </div>
            </div>
        </section>

        <!-- Game Play Area -->
        <section id="gameplay" class="section hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-8">
                    <!-- Game Header -->
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800" id="game-title">Quiz Game</h2>
                            <p class="text-gray-600" id="game-subtitle">Answer the questions correctly</p>
                        </div>
                        <div class="flex space-x-4">
                            <div class="bg-blue-100 px-4 py-2 rounded-lg">
                                <span class="text-blue-800 font-semibold">Score: <span id="current-score">0</span></span>
                            </div>
                            <div class="bg-green-100 px-4 py-2 rounded-lg">
                                <span class="text-green-800 font-semibold">Question: <span id="question-number">1</span>/<span id="total-questions-display">10</span></span>
                            </div>
                            <div class="bg-red-100 px-4 py-2 rounded-lg">
                                <span class="text-red-800 font-semibold">Time: <span id="time-left">30</span>s</span>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-6">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full transition-all duration-500" id="progress-bar" style="width: 0%"></div>
                    </div>

                    <!-- Question Area -->
                    <div class="text-center mb-8">
                        <div class="text-4xl mb-4" id="question-emoji">‚ùì</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-6" id="current-question">Loading question...</h3>
                        
                        <!-- Answer Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="answer-options">
                            <!-- Options will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Game Controls -->
                    <div class="flex justify-center space-x-4">
                        <button class="bg-gray-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-gray-600 transition-colors" onclick="pauseGame()">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button class="bg-red-500 text-white py-3 px-6 rounded-lg font-semibold hover:bg-red-600 transition-colors" onclick="quitGame()">
                            üö™ Quit
                        </button>
                    </div>

                    <!-- Feedback Area -->
                    <div id="answer-feedback" class="text-center mt-6 text-xl font-semibold hidden"></div>
                </div>
            </div>
        </section>

        <!-- Game Results -->
        <section id="game-results" class="section hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-8 text-center">
                    <div class="text-6xl mb-6" id="result-emoji">üéâ</div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4" id="result-title">Game Complete!</h2>
                    
                    <!-- Results Stats -->
                    <div class="grid md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-blue-50 rounded-xl p-4">
                            <div class="text-3xl font-bold text-blue-600" id="final-score">0</div>
                            <div class="text-blue-800">Final Score</div>
                        </div>
                        <div class="bg-green-50 rounded-xl p-4">
                            <div class="text-3xl font-bold text-green-600" id="correct-count">0</div>
                            <div class="text-green-800">Correct</div>
                        </div>
                        <div class="bg-red-50 rounded-xl p-4">
                            <div class="text-3xl font-bold text-red-600" id="wrong-count">0</div>
                            <div class="text-red-800">Wrong</div>
                        </div>
                        <div class="bg-purple-50 rounded-xl p-4">
                            <div class="text-3xl font-bold text-purple-600" id="accuracy-percentage">0%</div>
                            <div class="text-purple-800">Accuracy</div>
                        </div>
                    </div>

                    <!-- Rewards -->
                    <div class="mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">üèÜ Rewards Earned</h3>
                        <div id="rewards-earned" class="flex justify-center space-x-4">
                            <!-- Rewards will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="space-x-4">
                        <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 px-8 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all" onclick="playAgain()">
                            üîÑ Play Again
                        </button>
                        <button class="bg-gradient-to-r from-green-500 to-teal-500 text-white py-3 px-8 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition-all" onclick="showSection('home')">
                            üè† Home
                        </button>
                        <button class="bg-gradient-to-r from-pink-500 to-rose-500 text-white py-3 px-8 rounded-lg font-semibold hover:from-pink-600 hover:to-rose-600 transition-all" onclick="shareResults()">
                            üì§ Share
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Section -->
        <section id="leaderboard" class="section hidden">
            <h2 class="text-3xl font-bold text-white text-center mb-8">üèÖ Global Leaderboard</h2>
            
            <!-- Leaderboard Tabs -->
            <div class="flex justify-center mb-8">
                <div class="bg-white/10 backdrop-blur-md rounded-lg p-1">
                    <button class="leaderboard-tab bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-lg font-semibold" onclick="showLeaderboard('overall')">
                        üèÜ Overall
                    </button>
                    <button class="leaderboard-tab bg-transparent text-white px-6 py-2 rounded-lg font-semibold" onclick="showLeaderboard('weekly')">
                        üìÖ Weekly
                    </button>
                    <button class="leaderboard-tab bg-transparent text-white px-6 py-2 rounded-lg font-semibold" onclick="showLeaderboard('subject')">
                        üìö By Subject
                    </button>
                </div>
            </div>

            <!-- Player's Rank Card -->
            <div class="max-w-4xl mx-auto mb-8">
                <div class="bg-gradient-to-r from-yellow-400 to-orange-500 rounded-2xl p-6 glow-effect">
                    <div class="flex items-center justify-between text-white">
                        <div class="flex items-center space-x-4">
                            <div class="text-4xl">üë§</div>
                            <div>
                                <h3 class="text-2xl font-bold">Your Rank</h3>
                                <p class="text-white/90">Keep playing to climb higher!</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold" id="player-rank">#42</div>
                            <div class="text-white/90" id="player-total-score">2,450 pts</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Content -->
            <div class="max-w-6xl mx-auto">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-8">
                    <div id="leaderboard-content">
                        <!-- Leaderboard will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Achievements Section -->
        <section id="achievements" class="section hidden">
            <h2 class="text-3xl font-bold text-white text-center mb-8">üèÜ Your Achievements</h2>
            <div class="grid md:grid-cols-3 gap-6" id="achievements-grid">
                <!-- Achievements will be populated by JavaScript -->
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profile" class="section hidden">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-8">
                    <h2 class="text-3xl font-bold text-gray-800 text-center mb-8">üë§ Your Profile</h2>
                    
                    <!-- Profile Stats -->
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üìä Statistics</h3>
                            <div class="space-y-4" id="profile-stats">
                                <!-- Stats will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üéØ Recent Activity</h3>
                            <div class="space-y-4" id="recent-activity">
                                <!-- Recent activity will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer with Founder Info -->
    <footer class="bg-white/10 backdrop-blur-md border-t border-white/20 mt-16">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="text-center">
                <!-- App Info -->
                <div class="mb-6">
                    <div class="flex items-center justify-center space-x-3 mb-3">
                        <div class="text-4xl">üéÆ</div>
                        <h3 class="text-2xl font-bold text-white">Educational Game</h3>
                    </div>
                    <p class="text-white/80 text-lg">‡§ñ‡•á‡§≤ ‡§ñ‡•á‡§≤ ‡§Æ‡•á‡§Ç ‡§∏‡•Ä‡§ñ‡•á‡§Ç - Learn Through Gaming</p>
                </div>
                
                <!-- Founder Info -->
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6 max-w-md mx-auto">
                    <div class="flex items-center justify-center space-x-3 mb-4">
                        <div class="text-3xl">üë®‚Äçüíª</div>
                        <div>
                            <h4 class="text-xl font-bold text-white">Created by</h4>
                            <p class="text-white/90 font-semibold">Sachin SF28</p>
                        </div>
                    </div>
                    
                    <!-- Social Links -->
                    <div class="flex justify-center space-x-4">
                        <a href="https://www.instagram.com/sachin_sf28?igsh=YXRubGE1d2tqZmQ=" target="_blank" rel="noopener noreferrer" class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-6 py-3 rounded-full font-semibold hover:from-pink-600 hover:to-purple-600 transition-all flex items-center space-x-2 glow-effect">
                            <span class="text-xl">üì∑</span>
                            <span>Instagram</span>
                        </a>
                        <a href="https://www.facebook.com/share/17BU7Dr7Jj/" target="_blank" rel="noopener noreferrer" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-full font-semibold hover:from-blue-600 hover:to-blue-700 transition-all flex items-center space-x-2 glow-effect">
                            <span class="text-xl">üìò</span>
                            <span>Facebook</span>
                        </a>
                    </div>
                    
                    <p class="text-white/70 text-sm mt-4">
                        Follow the founder for updates and new features! üöÄ
                    </p>
                </div>
                
                <!-- App Stats -->
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="text-2xl mb-2">üéØ</div>
                        <div class="text-white font-semibold">Interactive Learning</div>
                        <div class="text-white/70 text-sm">Gamified Education</div>
                    </div>
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="text-2xl mb-2">üèÜ</div>
                        <div class="text-white font-semibold">Achievement System</div>
                        <div class="text-white/70 text-sm">Track Your Progress</div>
                    </div>
                    <div class="bg-white/5 rounded-xl p-4">
                        <div class="text-2xl mb-2">üë•</div>
                        <div class="text-white font-semibold">Multi-User Support</div>
                        <div class="text-white/70 text-sm">Family Friendly</div>
                    </div>
                </div>
                
                <!-- App Version and Update Check -->
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6 max-w-md mx-auto">
                    <div class="text-center">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <div class="text-3xl">üì±</div>
                            <div>
                                <h4 class="text-xl font-bold text-white">App Version</h4>
                                <p class="text-white/90 font-semibold" id="footer-version-display">v1.0.0</p>
                            </div>
                        </div>
                        
                        <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-full font-semibold hover:from-blue-600 hover:to-purple-600 transition-all glow-effect flex items-center space-x-2 mx-auto" onclick="manualUpdateCheck()" id="check-updates-btn">
                            <span class="text-xl">üîÑ</span>
                            <span>Check for Updates</span>
                        </button>
                        
                        <div class="text-white/70 text-sm mt-3" id="last-check-display">
                            Last checked: Never
                        </div>
                    </div>
                </div>
                
                <!-- Copyright -->
                <div class="border-t border-white/20 pt-6">
                    <p class="text-white/60 text-sm">
                        ¬© 2025 Educational Game. Made with ‚ù§Ô∏è by <span class="text-white font-semibold">Sachin SF28</span>
                    </p>
                    <p class="text-white/50 text-xs mt-2">
                        Educational Gaming Platform | Learn ‚Ä¢ Play ‚Ä¢ Achieve
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">üîë</div>
                <h2 class="text-2xl font-bold text-gray-800">Welcome Back!</h2>
                <p class="text-gray-600">Login to continue your learning journey</p>
            </div>
            
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üìß Email or Username</label>
                    <input type="text" id="login-username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your email or username" required>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üîí Password</label>
                    <input type="password" id="login-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your password" required>
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" id="remember-me" class="mr-2">
                        <span class="text-gray-700">Remember me</span>
                    </label>
                    <button type="button" class="text-blue-600 hover:text-blue-800 font-semibold" onclick="showForgotPassword()">
                        Forgot Password?
                    </button>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all">
                    üöÄ Login
                </button>
            </form>
            
            <div class="text-center mt-6">
                <p class="text-gray-600">Don't have an account? 
                    <button class="text-blue-600 hover:text-blue-800 font-semibold" onclick="switchToRegister()">
                        Register here
                    </button>
                </p>
            </div>
            
            <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('login-modal')">
                ‚úï
            </button>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="register-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full my-8 slide-up max-h-screen overflow-y-auto">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">‚ú®</div>
                <h2 class="text-2xl font-bold text-gray-800">Join EduGame Master!</h2>
                <p class="text-gray-600">Create your account and start learning</p>
            </div>
            
            <form id="register-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üë§ Full Name</label>
                    <input type="text" id="register-name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your full name" required>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üìß Email</label>
                    <input type="email" id="register-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your email" required>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üÜî Username</label>
                    <input type="text" id="register-username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Choose a username" required>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üîí Password</label>
                    <input type="password" id="register-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Create a strong password" required>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üîí Confirm Password</label>
                    <input type="password" id="register-confirm-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Confirm your password" required>
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üéÇ Age Group</label>
                    <select id="register-age" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                        <option value="">Select your age group</option>
                        <option value="6-10">6-10 years</option>
                        <option value="11-15">11-15 years</option>
                        <option value="16-20">16-20 years</option>
                        <option value="21+">21+ years</option>
                    </select>
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="agree-terms" class="mr-2" required>
                    <label class="text-gray-700">
                        I agree to the <button type="button" class="text-blue-600 hover:text-blue-800 font-semibold">Terms & Conditions</button>
                    </label>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-teal-500 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition-all">
                    üéâ Create Account
                </button>
            </form>
            
            <div class="text-center mt-6">
                <p class="text-gray-600">Already have an account? 
                    <button class="text-blue-600 hover:text-blue-800 font-semibold" onclick="switchToLogin()">
                        Login here
                    </button>
                </p>
            </div>
            
            <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('register-modal')">
                ‚úï
            </button>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center mb-6">
                <div class="text-4xl mb-4">üîë</div>
                <h2 class="text-2xl font-bold text-gray-800">Reset Password</h2>
                <p class="text-gray-600">Enter your email to receive reset instructions</p>
            </div>
            
            <form id="forgot-password-form" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">üìß Email</label>
                    <input type="email" id="forgot-email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your email" required>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-lg font-semibold hover:from-orange-600 hover:to-red-600 transition-all">
                    üìß Send Reset Link
                </button>
            </form>
            
            <div class="text-center mt-6">
                <button class="text-blue-600 hover:text-blue-800 font-semibold" onclick="switchToLogin()">
                    ‚Üê Back to Login
                </button>
            </div>
            
            <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('forgot-password-modal')">
                ‚úï
            </button>
        </div>
    </div>

    <!-- Welcome Modal (shown after successful registration) -->
    <div id="welcome-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center">
                <div class="text-6xl mb-4 celebration">üéâ</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Welcome to Educational Game!</h2>
                <p class="text-gray-600 mb-6">Your account has been created successfully. Start your learning journey now!</p>
                
                <div class="space-y-3 mb-6">
                    <div class="bg-blue-50 rounded-lg p-3 flex items-center">
                        <div class="text-2xl mr-3">üéØ</div>
                        <div class="text-left">
                            <div class="font-semibold text-blue-800">100 Welcome Coins</div>
                            <div class="text-sm text-blue-600">Start playing games!</div>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-3 flex items-center">
                        <div class="text-2xl mr-3">üèÜ</div>
                        <div class="text-left">
                            <div class="font-semibold text-green-800">First Steps Badge</div>
                            <div class="text-sm text-green-600">Your first achievement!</div>
                        </div>
                    </div>
                </div>
                
                <button class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all" onclick="closeWelcomeModal()">
                    üöÄ Start Learning!
                </button>
            </div>
        </div>
    </div>

    <!-- User Manager Modal -->
    <div id="user-manager-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full my-8 slide-up max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">üë• User Management</h2>
                    <p class="text-gray-600">Manage all registered users</p>
                </div>
                <button class="text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('user-manager-modal')">
                    ‚úï
                </button>
            </div>
            
            <!-- User Statistics -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-50 rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-blue-600" id="total-users-count">0</div>
                    <div class="text-blue-800 font-semibold">Total Users</div>
                </div>
                <div class="bg-green-50 rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-green-600" id="active-users-count">0</div>
                    <div class="text-green-800 font-semibold">Active Users</div>
                </div>
                <div class="bg-purple-50 rounded-xl p-6 text-center">
                    <div class="text-3xl font-bold text-purple-600" id="total-games-played">0</div>
                    <div class="text-purple-800 font-semibold">Total Games</div>
                </div>
            </div>
            
            <!-- Users List -->
            <div class="bg-gray-50 rounded-xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-gray-800">All Users</h3>
                    <button class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-4 py-2 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition-all" onclick="showRegister()">
                        ‚ûï Add New User
                    </button>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                <th class="text-left py-3 px-4 font-bold text-gray-800">User</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-800">Level</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-800">Coins</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-800">Games</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-800">Joined</th>
                                <th class="text-left py-3 px-4 font-bold text-gray-800">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Switch User Confirmation Modal -->
    <div id="switch-user-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center">
                <div class="text-4xl mb-4">üîÑ</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Switch User</h2>
                <p class="text-gray-600 mb-6">Do you want to switch to <span id="switch-to-user-name" class="font-semibold"></span>?</p>
                
                <div class="flex space-x-4">
                    <button class="flex-1 bg-gray-500 text-white py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors" onclick="closeModal('switch-user-modal')">
                        Cancel
                    </button>
                    <button class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all" onclick="confirmSwitchUser()">
                        Switch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full my-8 slide-up max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">‚öôÔ∏è Settings</h2>
                    <p class="text-gray-600">Customize your profile and preferences</p>
                </div>
                <button class="text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('settings-modal')">
                    ‚úï
                </button>
            </div>
            
            <!-- Profile Settings -->
            <div class="space-y-8">
                <!-- Profile Photo Section -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">üì∏</span>
                        Profile Photo
                    </h3>
                    
                    <div class="flex items-center space-x-6">
                        <div class="text-center">
                            <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center text-4xl shadow-lg mb-3" id="current-profile-photo">
                                üë§
                            </div>
                            <div class="text-sm text-gray-600">Current Photo</div>
                        </div>
                        
                        <div class="flex-1">
                            <div class="mb-4">
                                <label class="block text-gray-700 font-semibold mb-2">Choose Avatar</label>
                                <div class="grid grid-cols-6 gap-2" id="avatar-selector">
                                    <!-- Avatar options will be populated here -->
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 font-semibold mb-2">Or Upload Custom Photo</label>
                                <input type="file" id="photo-upload" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <div class="text-sm text-gray-500 mt-1">Supported: JPG, PNG, GIF (Max 2MB)</div>
                            </div>
                            
                            <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-2 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all" onclick="saveProfilePhoto()">
                                üíæ Save Photo
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Name Change Section -->
                <div class="bg-gradient-to-r from-green-50 to-teal-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">‚úèÔ∏è</span>
                        Change Name
                    </h3>
                    
                    <form id="change-name-form" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Current Name</label>
                            <div class="bg-gray-100 px-4 py-3 rounded-lg text-gray-800 font-semibold" id="current-name-display">
                                Loading...
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">New Name</label>
                            <input type="text" id="new-name-input" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" placeholder="Enter your new name" required>
                        </div>
                        
                        <button type="submit" class="bg-gradient-to-r from-green-500 to-teal-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition-all">
                            ‚úÖ Update Name
                        </button>
                    </form>
                </div>
                
                <!-- Password Change Section -->
                <div class="bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">üîí</span>
                        Change Password
                    </h3>
                    
                    <form id="change-password-form" class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Current Password</label>
                            <input type="password" id="current-password-input" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter current password" required>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">New Password</label>
                            <input type="password" id="new-password-input" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Enter new password" required>
                            <div class="text-sm text-gray-500 mt-1">Password must be at least 6 characters long</div>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-semibold mb-2">Confirm New Password</label>
                            <input type="password" id="confirm-new-password-input" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Confirm new password" required>
                        </div>
                        
                        <button type="submit" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-orange-600 hover:to-red-600 transition-all">
                            üîê Update Password
                        </button>
                    </form>
                </div>
                
                <!-- Account Info Section -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">‚ÑπÔ∏è</span>
                        Account Information
                    </h3>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white rounded-lg p-4">
                            <div class="text-sm text-gray-600">Username</div>
                            <div class="font-semibold text-gray-800" id="account-username">Loading...</div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <div class="text-sm text-gray-600">Email</div>
                            <div class="font-semibold text-gray-800" id="account-email">Loading...</div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <div class="text-sm text-gray-600">Age Group</div>
                            <div class="font-semibold text-gray-800" id="account-age-group">Loading...</div>
                        </div>
                        <div class="bg-white rounded-lg p-4">
                            <div class="text-sm text-gray-600">Member Since</div>
                            <div class="font-semibold text-gray-800" id="account-join-date">Loading...</div>
                        </div>
                    </div>
                </div>
                
                <!-- Danger Zone -->
                <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-xl p-6 border-2 border-red-200">
                    <h3 class="text-xl font-bold text-red-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">‚ö†Ô∏è</span>
                        Danger Zone
                    </h3>
                    
                    <div class="space-y-3">
                        <button class="w-full bg-red-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-600 transition-all" onclick="resetAllProgress()">
                            üîÑ Reset All Progress
                        </button>
                        <button class="w-full bg-red-700 text-white px-6 py-3 rounded-lg font-semibold hover:bg-red-800 transition-all" onclick="deleteAccount()">
                            üóëÔ∏è Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Details Modal -->
    <div id="update-details-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl p-8 max-w-4xl w-full my-8 slide-up max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800 flex items-center">
                        <span class="text-4xl mr-3">üöÄ</span>
                        Update Available
                    </h2>
                    <p class="text-gray-600">New version with exciting features and improvements</p>
                </div>
                <button class="text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('update-details-modal')">
                    ‚úï
                </button>
            </div>
            
            <!-- Version Comparison -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">üì±</span>
                        Current Version
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Version:</span>
                            <span class="font-semibold text-gray-800" id="current-version-display">1.0.0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Status:</span>
                            <span class="text-orange-600 font-semibold">Outdated</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 border-2 border-blue-200">
                    <h3 class="text-xl font-bold text-blue-800 mb-4 flex items-center">
                        <span class="text-2xl mr-3">‚ú®</span>
                        New Version
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-blue-600">Version:</span>
                            <span class="font-bold text-blue-800" id="new-version-display">1.1.0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-600">Release Date:</span>
                            <span class="font-semibold text-blue-800" id="release-date-display">Jan 15, 2025</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-blue-600">Size:</span>
                            <span class="font-semibold text-blue-800" id="file-size-display">2.5 MB</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- What's New Section -->
            <div class="space-y-8">
                <!-- New Features -->
                <div class="bg-green-50 rounded-xl p-6">
                    <h3 class="text-2xl font-bold text-green-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">üéâ</span>
                        New Features
                    </h3>
                    <div class="grid md:grid-cols-2 gap-3" id="new-features-list">
                        <!-- Features will be populated here -->
                    </div>
                </div>
                
                <!-- Bug Fixes -->
                <div class="bg-blue-50 rounded-xl p-6">
                    <h3 class="text-2xl font-bold text-blue-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">üîß</span>
                        Bug Fixes
                    </h3>
                    <div class="space-y-2" id="bug-fixes-list">
                        <!-- Bug fixes will be populated here -->
                    </div>
                </div>
                
                <!-- Improvements -->
                <div class="bg-purple-50 rounded-xl p-6">
                    <h3 class="text-2xl font-bold text-purple-800 mb-4 flex items-center">
                        <span class="text-3xl mr-3">‚ö°</span>
                        Improvements
                    </h3>
                    <div class="space-y-2" id="improvements-list">
                        <!-- Improvements will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Update Actions -->
            <div class="flex justify-center space-x-4 mt-8 pt-6 border-t border-gray-200">
                <button class="bg-gray-500 text-white px-8 py-3 rounded-lg font-semibold hover:bg-gray-600 transition-colors" onclick="remindLater()">
                    ‚è∞ Remind Later
                </button>
                <button class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-purple-600 transition-all glow-effect" onclick="startUpdateFromModal()">
                    üöÄ Update Now
                </button>
            </div>
            
            <!-- Data Safety Notice -->
            <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">üõ°Ô∏è</div>
                    <div>
                        <div class="font-semibold text-yellow-800">Your Data is Safe</div>
                        <div class="text-sm text-yellow-700">All your progress, achievements, and user data will be preserved during the update.</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Progress Modal -->
    <div id="update-progress-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 slide-up">
            <div class="text-center">
                <div class="text-6xl mb-4 celebration" id="update-progress-emoji">‚¨áÔ∏è</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4" id="update-progress-title">Downloading Update...</h2>
                <p class="text-gray-600 mb-6" id="update-progress-description">Please wait while we download the latest version</p>
                
                <!-- Progress Bar -->
                <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-4 rounded-full transition-all duration-500" id="update-progress-bar" style="width: 0%"></div>
                </div>
                
                <!-- Progress Text -->
                <div class="text-sm text-gray-600 mb-6">
                    <span id="update-progress-text">0%</span> - <span id="update-step-text">Initializing...</span>
                </div>
                
                <!-- Progress Steps -->
                <div class="flex justify-center space-x-4 mb-6">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center text-sm font-bold" id="step-download">1</div>
                        <span class="text-sm text-gray-600">Download</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-bold" id="step-install">2</div>
                        <span class="text-sm text-gray-600">Install</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-bold" id="step-restart">3</div>
                        <span class="text-sm text-gray-600">Restart</span>
                    </div>
                </div>
                
                <!-- Cancel Button (only during download) -->
                <button class="bg-red-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-600 transition-colors" id="cancel-update-btn" onclick="cancelUpdate()">
                    ‚ùå Cancel Update
                </button>
            </div>
        </div>
    </div>

    <!-- Device Info Modal -->
    <div id="device-info-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 overflow-y-auto">
        <div class="bg-white rounded-2xl p-8 max-w-2xl w-full my-8 slide-up max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">üì± Device Information</h2>
                    <p class="text-gray-600">Privacy and device details</p>
                </div>
                <button class="text-gray-500 hover:text-gray-700 text-2xl" onclick="closeModal('device-info-modal')">
                    ‚úï
                </button>
            </div>
            
            <!-- Device Privacy Info -->
            <div class="bg-blue-50 rounded-xl p-6 mb-6">
                <div class="flex items-center mb-4">
                    <div class="text-3xl mr-3">üîí</div>
                    <div>
                        <h3 class="text-xl font-bold text-blue-800">Privacy Protection</h3>
                        <p class="text-blue-600">Your data is protected with device-specific privacy</p>
                    </div>
                </div>
                <div class="text-sm text-blue-700 space-y-2">
                    <p>‚Ä¢ Only users who have logged in on THIS device are visible in the user list</p>
                    <p>‚Ä¢ Other devices cannot see your user accounts</p>
                    <p>‚Ä¢ You can login from any device using your username/email and password</p>
                    <p>‚Ä¢ Your game progress syncs across all your devices</p>
                </div>
            </div>
            
            <!-- Current Device Info -->
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-50 rounded-xl p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üñ•Ô∏è Current Device</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Device ID:</span>
                            <span class="font-mono text-xs bg-gray-200 px-2 py-1 rounded" id="current-device-id">Loading...</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Users on Device:</span>
                            <span class="font-semibold text-blue-600" id="device-users-count">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Browser:</span>
                            <span class="text-gray-800" id="browser-info">Loading...</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Screen:</span>
                            <span class="text-gray-800" id="screen-info">Loading...</span>
                        </div>
                    </div>
                </div>
                
                <div class="bg-green-50 rounded-xl p-6">
                    <h3 class="text-lg font-bold text-green-800 mb-4">‚úÖ Security Features</h3>
                    <div class="space-y-2 text-sm text-green-700">
                        <div class="flex items-center">
                            <span class="mr-2">üîê</span>
                            <span>Device-specific user isolation</span>
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">üîÑ</span>
                            <span>Cross-device data sync</span>
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">üõ°Ô∏è</span>
                            <span>Secure password storage</span>
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">üë•</span>
                            <span>Multi-user support</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Device Users List -->
            <div class="bg-gray-50 rounded-xl p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üë• Users on This Device</h3>
                <div id="device-users-list" class="space-y-2">
                    <!-- Device users will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // App Configuration and Update System
        const APP_CONFIG = {
            currentVersion: '1.0.0',
            appName: 'Educational Game',
            updateCheckUrl: 'https://api.github.com/repos/sachinsf28/educational-game/releases/latest', // Replace with your actual repo
            updateCheckInterval: 24 * 60 * 60 * 1000, // 24 hours
            reminderInterval: 6 * 60 * 60 * 1000, // 6 hours
            lastUpdateCheck: null,
            lastUpdateReminder: null
        };

        // Mock Update Data (Replace with real API call in production)
        const MOCK_UPDATE_DATA = {
            version: '1.1.0',
            releaseDate: '2025-01-15',
            downloadUrl: 'https://github.com/sachinsf28/educational-game/releases/download/v1.1.0/educational-game-v1.1.0.html',
            fileSize: '2.5 MB',
            features: [
                'üéØ New Memory Challenge Game Mode',
                'üèÜ Advanced Achievement System',
                'üìä Detailed Performance Analytics',
                'üåü Daily Challenges and Rewards',
                'üé® New Avatar Collection',
                'üîä Sound Effects and Music',
                'üì± Better Mobile Experience',
                'üåç Multi-language Support'
            ],
            bugFixes: [
                'Fixed timer issues in Time Attack mode',
                'Improved question loading speed',
                'Better error handling for network issues',
                'Enhanced data synchronization',
                'Fixed leaderboard sorting issues'
            ],
            improvements: [
                'Faster app loading time',
                'Better user interface animations',
                'Improved accessibility features',
                'Enhanced security measures'
            ]
        };

        // Update System State
        let updateState = {
            isUpdateAvailable: false,
            updateData: null,
            isChecking: false,
            isUpdating: false,
            updateProgress: 0
        };

        // Game State
        let gameState = {
            currentSection: 'home',
            isLoggedIn: false,
            currentUser: null,
            player: {
                coins: 0,
                level: 1,
                streak: 0,
                gamesPlayed: 0,
                correctAnswers: 0,
                totalQuestions: 0,
                achievements: [],
                recentActivity: [],
                totalScore: 0,
                bestScore: 0,
                playerName: 'Player',
                email: '',
                username: '',
                avatar: 'üë§',
                ageGroup: '',
                joinDate: null
            },
            currentGame: {
                mode: '',
                subject: '',
                questions: [],
                currentQuestion: 0,
                score: 0,
                timeLeft: 30,
                timer: null,
                isActive: false
            },
            leaderboard: {
                currentTab: 'overall'
            }
        };

        // Generate Dynamic Leaderboard from Registered Users
        function generateLeaderboardData() {
            const allUsers = getAllUsers();
            const leaderboardUsers = [];
            
            // Get game data for each user
            allUsers.forEach(user => {
                const userData = localStorage.getItem('eduGameUser_' + user.username);
                if (userData) {
                    const gameData = JSON.parse(userData);
                    if (gameData.gamesPlayed > 0) { // Only include users who have played games
                        leaderboardUsers.push({
                            name: user.playerName,
                            username: user.username,
                            score: gameData.totalScore || 0,
                            level: gameData.level || 1,
                            games: gameData.gamesPlayed || 0,
                            accuracy: gameData.totalQuestions > 0 ? Math.round((gameData.correctAnswers / gameData.totalQuestions) * 100) : 0,
                            avatar: user.avatar,
                            coins: gameData.coins || 0,
                            correctAnswers: gameData.correctAnswers || 0,
                            totalQuestions: gameData.totalQuestions || 0,
                            joinDate: user.joinDate
                        });
                    }
                }
            });
            
            // Sort by total score (descending)
            leaderboardUsers.sort((a, b) => b.score - a.score);
            
            return {
                overall: leaderboardUsers,
                weekly: leaderboardUsers.slice(0, 10), // Top 10 for weekly (in real app, filter by date)
                subjects: {
                    math: leaderboardUsers.slice(0, 5),
                    science: leaderboardUsers.slice(0, 5),
                    english: leaderboardUsers.slice(0, 5)
                }
            };
        }

        // Infinite Question Database with Dynamic Generation
        const questionDatabase = {
            math: {
                basic: [
                    { question: "15 + 27 = ?", options: ["42", "41", "43", "40"], correct: 0, emoji: "‚ûï" },
                    { question: "8 √ó 7 = ?", options: ["54", "56", "58", "52"], correct: 1, emoji: "‚úñÔ∏è" },
                    { question: "144 √∑ 12 = ?", options: ["11", "13", "12", "14"], correct: 2, emoji: "‚ûó" },
                    { question: "25% of 80 = ?", options: ["15", "20", "25", "30"], correct: 1, emoji: "üìä" },
                    { question: "‚àö64 = ?", options: ["6", "7", "8", "9"], correct: 2, emoji: "‚àö" },
                    { question: "12 + 18 = ?", options: ["30", "29", "31", "28"], correct: 0, emoji: "‚ûï" },
                    { question: "9 √ó 6 = ?", options: ["52", "54", "56", "58"], correct: 1, emoji: "‚úñÔ∏è" },
                    { question: "81 √∑ 9 = ?", options: ["8", "9", "10", "7"], correct: 1, emoji: "‚ûó" },
                    { question: "50% of 60 = ?", options: ["25", "30", "35", "40"], correct: 1, emoji: "üìä" },
                    { question: "‚àö36 = ?", options: ["5", "6", "7", "8"], correct: 1, emoji: "‚àö" }
                ],
                intermediate: [
                    { question: "3¬≤ + 4¬≤ = ?", options: ["25", "24", "26", "23"], correct: 0, emoji: "¬≤" },
                    { question: "If x + 5 = 12, then x = ?", options: ["6", "7", "8", "5"], correct: 1, emoji: "üî¢" },
                    { question: "Area of rectangle: length=8, width=5", options: ["40", "39", "41", "38"], correct: 0, emoji: "üìê" },
                    { question: "5¬≤ - 3¬≤ = ?", options: ["16", "15", "17", "14"], correct: 0, emoji: "¬≤" },
                    { question: "If 2x = 14, then x = ?", options: ["6", "7", "8", "9"], correct: 1, emoji: "üî¢" },
                    { question: "Perimeter of square with side 6", options: ["24", "22", "26", "20"], correct: 0, emoji: "üìê" }
                ],
                advanced: [
                    { question: "Solve: 2x + 3 = 11", options: ["x = 4", "x = 3", "x = 5", "x = 6"], correct: 0, emoji: "üßÆ" },
                    { question: "sin(30¬∞) = ?", options: ["1/2", "‚àö3/2", "1", "0"], correct: 0, emoji: "üìê" },
                    { question: "log‚ÇÇ(8) = ?", options: ["2", "3", "4", "5"], correct: 1, emoji: "üìä" }
                ]
            },
            science: {
                physics: [
                    { question: "Speed of light in vacuum?", options: ["3√ó10‚Å∏ m/s", "3√ó10‚Å∑ m/s", "3√ó10‚Åπ m/s", "3√ó10‚Å∂ m/s"], correct: 0, emoji: "üí°" },
                    { question: "Unit of force?", options: ["Joule", "Newton", "Watt", "Pascal"], correct: 1, emoji: "‚ö°" },
                    { question: "Formula for kinetic energy?", options: ["mgh", "¬Ωmv¬≤", "mc¬≤", "Fd"], correct: 1, emoji: "üèÉ" },
                    { question: "Acceleration due to gravity?", options: ["9.8 m/s¬≤", "10 m/s¬≤", "8.9 m/s¬≤", "11 m/s¬≤"], correct: 0, emoji: "üåç" },
                    { question: "Unit of electric current?", options: ["Volt", "Ampere", "Ohm", "Watt"], correct: 1, emoji: "‚ö°" },
                    { question: "Formula for power?", options: ["F√ód", "m√óa", "V√óI", "¬Ωmv¬≤"], correct: 2, emoji: "üîã" }
                ],
                chemistry: [
                    { question: "Chemical symbol for Gold?", options: ["Go", "Gd", "Au", "Ag"], correct: 2, emoji: "ü•á" },
                    { question: "pH of pure water?", options: ["6", "7", "8", "9"], correct: 1, emoji: "üíß" },
                    { question: "Number of electrons in Carbon?", options: ["4", "6", "8", "12"], correct: 1, emoji: "‚öõÔ∏è" },
                    { question: "Chemical formula of water?", options: ["H‚ÇÇO", "CO‚ÇÇ", "NaCl", "CH‚ÇÑ"], correct: 0, emoji: "üíß" },
                    { question: "Atomic number of Oxygen?", options: ["6", "7", "8", "9"], correct: 2, emoji: "‚öõÔ∏è" },
                    { question: "Most abundant gas in air?", options: ["Oxygen", "Nitrogen", "Carbon dioxide", "Hydrogen"], correct: 1, emoji: "üå¨Ô∏è" }
                ],
                biology: [
                    { question: "Largest organ in human body?", options: ["Heart", "Brain", "Liver", "Skin"], correct: 3, emoji: "üß¨" },
                    { question: "Process of photosynthesis occurs in?", options: ["Roots", "Stem", "Leaves", "Flowers"], correct: 2, emoji: "üå±" },
                    { question: "Human heart has how many chambers?", options: ["2", "3", "4", "5"], correct: 2, emoji: "‚ù§Ô∏è" },
                    { question: "DNA stands for?", options: ["Deoxyribonucleic Acid", "Ribonucleic Acid", "Amino Acid", "Fatty Acid"], correct: 0, emoji: "üß¨" },
                    { question: "Which blood group is universal donor?", options: ["A", "B", "AB", "O"], correct: 3, emoji: "ü©∏" }
                ]
            },
            english: {
                vocabulary: [
                    { question: "Synonym of 'Happy'?", options: ["Sad", "Joyful", "Angry", "Tired"], correct: 1, emoji: "üòä" },
                    { question: "Antonym of 'Big'?", options: ["Large", "Huge", "Small", "Giant"], correct: 2, emoji: "üìè" },
                    { question: "Past tense of 'Go'?", options: ["Went", "Gone", "Going", "Goes"], correct: 0, emoji: "üö∂" },
                    { question: "Synonym of 'Beautiful'?", options: ["Ugly", "Pretty", "Bad", "Dirty"], correct: 1, emoji: "üå∏" },
                    { question: "Plural of 'Child'?", options: ["Childs", "Children", "Childes", "Child"], correct: 1, emoji: "üë∂" },
                    { question: "Antonym of 'Hot'?", options: ["Warm", "Cool", "Cold", "Mild"], correct: 2, emoji: "üßä" }
                ],
                grammar: [
                    { question: "Which is a noun?", options: ["Run", "Beautiful", "Book", "Quickly"], correct: 2, emoji: "üìö" },
                    { question: "Correct sentence?", options: ["He are going", "He is going", "He am going", "He were going"], correct: 1, emoji: "‚úÖ" },
                    { question: "Past tense of 'Eat'?", options: ["Eated", "Ate", "Eaten", "Eating"], correct: 1, emoji: "üçΩÔ∏è" },
                    { question: "Which is an adjective?", options: ["Run", "Fast", "Running", "Runner"], correct: 1, emoji: "‚ö°" },
                    { question: "Correct plural form?", options: ["Mouses", "Mice", "Mouse", "Mices"], correct: 1, emoji: "üê≠" }
                ],
                reading: [
                    { question: "What does 'Bibliography' mean?", options: ["Life story", "Book list", "Geography", "Biography"], correct: 1, emoji: "üìñ" },
                    { question: "A story with moral lesson is called?", options: ["Novel", "Fable", "Poem", "Essay"], correct: 1, emoji: "üìö" },
                    { question: "Main character in a story is called?", options: ["Antagonist", "Protagonist", "Narrator", "Author"], correct: 1, emoji: "üé≠" }
                ]
            },
            history: {
                world: [
                    { question: "First President of India?", options: ["Nehru", "Gandhi", "Dr. Rajendra Prasad", "Patel"], correct: 2, emoji: "üáÆüá≥" },
                    { question: "Year of Indian Independence?", options: ["1946", "1947", "1948", "1949"], correct: 1, emoji: "üóìÔ∏è" },
                    { question: "Who built the Taj Mahal?", options: ["Akbar", "Shah Jahan", "Humayun", "Aurangzeb"], correct: 1, emoji: "üïå" },
                    { question: "First World War started in?", options: ["1912", "1914", "1916", "1918"], correct: 1, emoji: "‚öîÔ∏è" },
                    { question: "Who discovered America?", options: ["Vasco da Gama", "Christopher Columbus", "Marco Polo", "Magellan"], correct: 1, emoji: "üåé" }
                ],
                indian: [
                    { question: "Battle of Panipat was fought in?", options: ["1526", "1556", "1761", "All of these"], correct: 3, emoji: "‚öîÔ∏è" },
                    { question: "Quit India Movement started in?", options: ["1940", "1942", "1944", "1946"], correct: 1, emoji: "üáÆüá≥" },
                    { question: "Who was known as Iron Man of India?", options: ["Nehru", "Patel", "Bose", "Gandhi"], correct: 1, emoji: "üí™" }
                ],
                modern: [
                    { question: "Berlin Wall fell in?", options: ["1987", "1989", "1991", "1993"], correct: 1, emoji: "üß±" },
                    { question: "World War II ended in?", options: ["1944", "1945", "1946", "1947"], correct: 1, emoji: "üïäÔ∏è" },
                    { question: "United Nations was formed in?", options: ["1944", "1945", "1946", "1947"], correct: 1, emoji: "üåç" }
                ]
            },
            geography: {
                countries: [
                    { question: "Capital of Australia?", options: ["Sydney", "Melbourne", "Canberra", "Perth"], correct: 2, emoji: "üåè" },
                    { question: "Longest river in the world?", options: ["Amazon", "Nile", "Ganges", "Mississippi"], correct: 1, emoji: "üèûÔ∏è" },
                    { question: "Capital of Canada?", options: ["Toronto", "Vancouver", "Ottawa", "Montreal"], correct: 2, emoji: "üçÅ" },
                    { question: "Largest country by area?", options: ["China", "USA", "Russia", "India"], correct: 2, emoji: "üó∫Ô∏è" },
                    { question: "Capital of Brazil?", options: ["Rio de Janeiro", "S√£o Paulo", "Bras√≠lia", "Salvador"], correct: 2, emoji: "üáßüá∑" }
                ],
                physical: [
                    { question: "Highest mountain peak?", options: ["K2", "Mount Everest", "Kangchenjunga", "Makalu"], correct: 1, emoji: "üèîÔ∏è" },
                    { question: "Largest ocean?", options: ["Atlantic", "Indian", "Pacific", "Arctic"], correct: 2, emoji: "üåä" },
                    { question: "Largest desert?", options: ["Gobi", "Sahara", "Kalahari", "Arabian"], correct: 1, emoji: "üèúÔ∏è" }
                ],
                indian: [
                    { question: "Longest river in India?", options: ["Yamuna", "Ganga", "Godavari", "Krishna"], correct: 1, emoji: "üèûÔ∏è" },
                    { question: "Highest peak in India?", options: ["Kanchenjunga", "Nanda Devi", "K2", "Kamet"], correct: 0, emoji: "üèîÔ∏è" },
                    { question: "Southernmost point of India?", options: ["Kanyakumari", "Indira Point", "Rameshwaram", "Tuticorin"], correct: 1, emoji: "üó∫Ô∏è" }
                ]
            },
            gk: {
                current: [
                    { question: "Current President of India?", options: ["Ram Nath Kovind", "Droupadi Murmu", "Pranab Mukherjee", "APJ Abdul Kalam"], correct: 1, emoji: "üáÆüá≥" },
                    { question: "Capital of Telangana?", options: ["Warangal", "Nizamabad", "Hyderabad", "Karimnagar"], correct: 2, emoji: "üèõÔ∏è" },
                    { question: "Latest state formed in India?", options: ["Jharkhand", "Chhattisgarh", "Telangana", "Uttarakhand"], correct: 2, emoji: "üó∫Ô∏è" }
                ],
                sports: [
                    { question: "How many players in cricket team?", options: ["10", "11", "12", "9"], correct: 1, emoji: "üèè" },
                    { question: "Olympics held every __ years?", options: ["2", "3", "4", "5"], correct: 2, emoji: "üèÖ" },
                    { question: "National sport of India?", options: ["Cricket", "Hockey", "Football", "Kabaddi"], correct: 1, emoji: "üèë" }
                ],
                tech: [
                    { question: "Full form of CPU?", options: ["Central Processing Unit", "Computer Processing Unit", "Central Program Unit", "Computer Program Unit"], correct: 0, emoji: "üíª" },
                    { question: "Founder of Microsoft?", options: ["Steve Jobs", "Bill Gates", "Mark Zuckerberg", "Larry Page"], correct: 1, emoji: "üíº" },
                    { question: "What does WWW stand for?", options: ["World Wide Web", "World Web Wide", "Wide World Web", "Web World Wide"], correct: 0, emoji: "üåê" }
                ]
            }
        };

        // Dynamic Question Generators for Infinite Content
        const questionGenerators = {
            math: {
                basic: {
                    addition: () => {
                        const a = Math.floor(Math.random() * 50) + 10;
                        const b = Math.floor(Math.random() * 50) + 10;
                        const correct = a + b;
                        const options = [correct, correct + 1, correct - 1, correct + 2].sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(correct);
                        return {
                            question: `${a} + ${b} = ?`,
                            options: options.map(String),
                            correct: correctIndex,
                            emoji: "‚ûï"
                        };
                    },
                    multiplication: () => {
                        const a = Math.floor(Math.random() * 12) + 2;
                        const b = Math.floor(Math.random() * 12) + 2;
                        const correct = a * b;
                        const options = [correct, correct + a, correct - a, correct + b].sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(correct);
                        return {
                            question: `${a} √ó ${b} = ?`,
                            options: options.map(String),
                            correct: correctIndex,
                            emoji: "‚úñÔ∏è"
                        };
                    },
                    division: () => {
                        const b = Math.floor(Math.random() * 10) + 2;
                        const correct = Math.floor(Math.random() * 15) + 2;
                        const a = b * correct;
                        const options = [correct, correct + 1, correct - 1, correct + 2].sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(correct);
                        return {
                            question: `${a} √∑ ${b} = ?`,
                            options: options.map(String),
                            correct: correctIndex,
                            emoji: "‚ûó"
                        };
                    },
                    percentage: () => {
                        const percentages = [10, 20, 25, 50, 75];
                        const numbers = [20, 40, 60, 80, 100, 120, 160, 200];
                        const percent = percentages[Math.floor(Math.random() * percentages.length)];
                        const number = numbers[Math.floor(Math.random() * numbers.length)];
                        const correct = (percent * number) / 100;
                        const options = [correct, correct + 5, correct - 5, correct + 10].sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(correct);
                        return {
                            question: `${percent}% of ${number} = ?`,
                            options: options.map(String),
                            correct: correctIndex,
                            emoji: "üìä"
                        };
                    }
                },
                intermediate: {
                    algebra: () => {
                        const a = Math.floor(Math.random() * 10) + 2;
                        const b = Math.floor(Math.random() * 20) + 5;
                        const correct = b - a;
                        const options = [correct, correct + 1, correct - 1, correct + 2].sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(correct);
                        return {
                            question: `If x + ${a} = ${b}, then x = ?`,
                            options: options.map(String),
                            correct: correctIndex,
                            emoji: "üî¢"
                        };
                    },
                    geometry: () => {
                        const side = Math.floor(Math.random() * 10) + 3;
                        const correct = side * side;
                        const options = [correct, correct + side, correct - side, correct + 2*side].sort(() => Math.random() - 0.5);
                        const correctIndex = options.indexOf(correct);
                        return {
                            question: `Area of square with side ${side} = ?`,
                            options: options.map(String),
                            correct: correctIndex,
                            emoji: "üìê"
                        };
                    }
                }
            },
            english: {
                vocabulary: () => {
                    const words = [
                        { word: "Brave", synonym: "Courageous", options: ["Coward", "Courageous", "Weak", "Scared"] },
                        { word: "Smart", synonym: "Intelligent", options: ["Stupid", "Intelligent", "Dull", "Foolish"] },
                        { word: "Fast", synonym: "Quick", options: ["Slow", "Quick", "Lazy", "Tired"] },
                        { word: "Strong", synonym: "Powerful", options: ["Weak", "Powerful", "Fragile", "Soft"] },
                        { word: "Kind", synonym: "Gentle", options: ["Cruel", "Gentle", "Mean", "Harsh"] }
                    ];
                    const wordData = words[Math.floor(Math.random() * words.length)];
                    const correctIndex = wordData.options.indexOf(wordData.synonym);
                    return {
                        question: `Synonym of '${wordData.word}'?`,
                        options: wordData.options,
                        correct: correctIndex,
                        emoji: "üìù"
                    };
                }
            }
        };

        // Load game state from localStorage
        function loadGameState() {
            const saved = localStorage.getItem('eduGameState');
            if (saved) {
                const savedState = JSON.parse(saved);
                gameState.player = { ...gameState.player, ...savedState.player };
                updateUI();
            }
        }

        // Save game state to localStorage
        function saveGameState() {
            if (gameState.isLoggedIn && gameState.currentUser) {
                // Save user-specific data
                localStorage.setItem('eduGameUser_' + gameState.currentUser.username, JSON.stringify(gameState.player));
            } else {
                // Save guest data
                localStorage.setItem('eduGameState', JSON.stringify(gameState));
            }
        }

        // Update UI elements
        function updateUI() {
            document.getElementById('totalCoins').textContent = gameState.player.coins;
            document.getElementById('playerLevel').textContent = gameState.player.level;
            document.getElementById('streakCount').textContent = gameState.player.streak;
            document.getElementById('gamesPlayed').textContent = gameState.player.gamesPlayed;
            document.getElementById('correctAnswers').textContent = gameState.player.correctAnswers;
            
            const accuracy = gameState.player.totalQuestions > 0 ? 
                Math.round((gameState.player.correctAnswers / gameState.player.totalQuestions) * 100) : 0;
            document.getElementById('accuracyRate').textContent = accuracy + '%';
            document.getElementById('totalBadges').textContent = gameState.player.achievements.length;
        }

        // Section Navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-purple-500');
                btn.classList.add('bg-white/10');
            });
            
            event.target.classList.remove('bg-white/10');
            event.target.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-purple-500');
            
            gameState.currentSection = sectionName;
            
            // Initialize section-specific content
            if (sectionName === 'achievements') {
                initializeAchievements();
            } else if (sectionName === 'profile') {
                initializeProfile();
            } else if (sectionName === 'leaderboard') {
                initializeLeaderboard();
            }
        }

        // Check if user is logged in before starting games
        function checkLoginRequired() {
            if (!gameState.isLoggedIn) {
                showError('Please register/login first to play games! üéÆ');
                showRegister();
                return false;
            }
            return true;
        }

        // Start Quick Game
        function startQuickGame(subject) {
            if (!checkLoginRequired()) return;
            
            gameState.currentGame.mode = 'quick';
            gameState.currentGame.subject = subject;
            startGame();
        }

        // Start Subject Game
        function startSubjectGame(subject, level) {
            if (!checkLoginRequired()) return;
            
            gameState.currentGame.mode = 'subject';
            gameState.currentGame.subject = subject;
            gameState.currentGame.level = level;
            startGame();
        }

        // Start Game Mode
        function startGameMode(mode) {
            if (!checkLoginRequired()) return;
            
            gameState.currentGame.mode = mode;
            gameState.currentGame.subject = 'mixed';
            startGame();
        }

        // Start Game
        function startGame() {
            // Generate questions based on game mode and subject
            generateQuestions();
            
            // Initialize game state
            gameState.currentGame.currentQuestion = 0;
            gameState.currentGame.score = 0;
            gameState.currentGame.isActive = true;
            
            // Show gameplay section
            showGameplaySection();
            
            // Start first question
            showQuestion();
        }

        // Generate Infinite Questions
        function generateQuestions() {
            let questions = [];
            const mode = gameState.currentGame.mode;
            const subject = gameState.currentGame.subject;
            
            // Determine number of questions based on mode
            let questionCount = 10;
            if (mode === 'quick') questionCount = 5;
            else if (mode === 'marathon') questionCount = 20;
            else if (mode === 'timeattack') questionCount = 50; // More questions for time attack
            else if (mode === 'survival') questionCount = 100; // Infinite for survival mode
            else if (mode === 'infinite') questionCount = 1000; // Truly infinite mode
            else if (mode === 'practice') questionCount = 50; // Practice mode with no time pressure
            
            // Get questions from database and generate dynamic ones
            if (subject === 'mixed') {
                // Mix questions from all subjects
                const allQuestions = [];
                Object.values(questionDatabase).forEach(subjectQuestions => {
                    if (Array.isArray(subjectQuestions)) {
                        allQuestions.push(...subjectQuestions);
                    } else {
                        Object.values(subjectQuestions).forEach(levelQuestions => {
                            if (Array.isArray(levelQuestions)) {
                                allQuestions.push(...levelQuestions);
                            }
                        });
                    }
                });
                
                // Add dynamic questions
                const dynamicQuestions = generateDynamicQuestions(questionCount / 2, 'mixed');
                allQuestions.push(...dynamicQuestions);
                
                questions = shuffleArray(allQuestions).slice(0, questionCount);
            } else {
                // Get questions from specific subject
                const subjectQuestions = questionDatabase[subject];
                let staticQuestions = [];
                
                if (subjectQuestions) {
                    if (Array.isArray(subjectQuestions)) {
                        staticQuestions = [...subjectQuestions];
                    } else {
                        const level = gameState.currentGame.level || Object.keys(subjectQuestions)[0];
                        const levelQuestions = subjectQuestions[level] || [];
                        staticQuestions = [...levelQuestions];
                    }
                }
                
                // Generate dynamic questions to fill the gap
                const dynamicCount = Math.max(0, questionCount - staticQuestions.length);
                const dynamicQuestions = generateDynamicQuestions(dynamicCount, subject, gameState.currentGame.level);
                
                // Combine static and dynamic questions
                const allQuestions = [...staticQuestions, ...dynamicQuestions];
                questions = shuffleArray(allQuestions).slice(0, questionCount);
            }
            
            gameState.currentGame.questions = questions;
        }

        // Generate Dynamic Questions for Infinite Content
        function generateDynamicQuestions(count, subject, level = null) {
            const questions = [];
            
            for (let i = 0; i < count; i++) {
                let question = null;
                
                if (subject === 'math' || subject === 'mixed') {
                    question = generateMathQuestion(level);
                } else if (subject === 'english' || subject === 'mixed') {
                    question = generateEnglishQuestion(level);
                } else if (subject === 'science' || subject === 'mixed') {
                    question = generateScienceQuestion(level);
                } else if (subject === 'history' || subject === 'mixed') {
                    question = generateHistoryQuestion();
                } else if (subject === 'geography' || subject === 'mixed') {
                    question = generateGeographyQuestion();
                } else if (subject === 'gk' || subject === 'mixed') {
                    question = generateGKQuestion();
                }
                
                if (question) {
                    questions.push(question);
                }
            }
            
            return questions;
        }

        // Generate Math Questions Dynamically
        function generateMathQuestion(level = 'basic') {
            const generators = questionGenerators.math[level] || questionGenerators.math.basic;
            const generatorKeys = Object.keys(generators);
            const randomGenerator = generators[generatorKeys[Math.floor(Math.random() * generatorKeys.length)]];
            return randomGenerator();
        }

        // Generate English Questions Dynamically
        function generateEnglishQuestion(level = 'vocabulary') {
            if (questionGenerators.english.vocabulary) {
                return questionGenerators.english.vocabulary();
            }
            
            // Fallback to antonym questions
            const words = [
                { word: "Light", antonym: "Dark", options: ["Bright", "Dark", "Heavy", "Fast"] },
                { word: "Up", antonym: "Down", options: ["Left", "Right", "Down", "Forward"] },
                { word: "Good", antonym: "Bad", options: ["Great", "Bad", "Nice", "Fine"] },
                { word: "New", antonym: "Old", options: ["Fresh", "Old", "Modern", "Recent"] },
                { word: "Easy", antonym: "Hard", options: ["Simple", "Hard", "Soft", "Quick"] }
            ];
            
            const wordData = words[Math.floor(Math.random() * words.length)];
            const correctIndex = wordData.options.indexOf(wordData.antonym);
            
            return {
                question: `Antonym of '${wordData.word}'?`,
                options: wordData.options,
                correct: correctIndex,
                emoji: "üìù"
            };
        }

        // Generate Science Questions Dynamically
        function generateScienceQuestion(level = 'physics') {
            const scienceQuestions = [
                { question: "What gas do plants absorb during photosynthesis?", options: ["Oxygen", "Carbon dioxide", "Nitrogen", "Hydrogen"], correct: 1, emoji: "üå±" },
                { question: "How many bones are in adult human body?", options: ["206", "208", "210", "204"], correct: 0, emoji: "ü¶¥" },
                { question: "What is the hardest natural substance?", options: ["Gold", "Iron", "Diamond", "Silver"], correct: 2, emoji: "üíé" },
                { question: "Which planet is closest to the Sun?", options: ["Venus", "Mercury", "Earth", "Mars"], correct: 1, emoji: "‚òÄÔ∏è" },
                { question: "What is the chemical symbol for Iron?", options: ["Ir", "Fe", "In", "Fr"], correct: 1, emoji: "‚öõÔ∏è" }
            ];
            
            return scienceQuestions[Math.floor(Math.random() * scienceQuestions.length)];
        }

        // Generate History Questions Dynamically
        function generateHistoryQuestion() {
            const historyQuestions = [
                { question: "Who was the first man to walk on the moon?", options: ["Buzz Aldrin", "Neil Armstrong", "John Glenn", "Alan Shepard"], correct: 1, emoji: "üåô" },
                { question: "In which year did World War I begin?", options: ["1912", "1914", "1916", "1918"], correct: 1, emoji: "‚öîÔ∏è" },
                { question: "Who painted the Mona Lisa?", options: ["Van Gogh", "Picasso", "Leonardo da Vinci", "Michelangelo"], correct: 2, emoji: "üé®" },
                { question: "Which empire was ruled by Julius Caesar?", options: ["Greek", "Roman", "Egyptian", "Persian"], correct: 1, emoji: "üèõÔ∏è" },
                { question: "When did the Titanic sink?", options: ["1910", "1912", "1914", "1916"], correct: 1, emoji: "üö¢" }
            ];
            
            return historyQuestions[Math.floor(Math.random() * historyQuestions.length)];
        }

        // Generate Geography Questions Dynamically
        function generateGeographyQuestion() {
            const geoQuestions = [
                { question: "Which is the smallest country in the world?", options: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"], correct: 1, emoji: "üó∫Ô∏è" },
                { question: "Mount Kilimanjaro is located in which country?", options: ["Kenya", "Tanzania", "Uganda", "Ethiopia"], correct: 1, emoji: "üèîÔ∏è" },
                { question: "Which river flows through Paris?", options: ["Thames", "Rhine", "Seine", "Danube"], correct: 2, emoji: "üèûÔ∏è" },
                { question: "What is the capital of New Zealand?", options: ["Auckland", "Wellington", "Christchurch", "Hamilton"], correct: 1, emoji: "üá≥üáø" },
                { question: "Which desert is the largest in the world?", options: ["Sahara", "Gobi", "Kalahari", "Antarctica"], correct: 3, emoji: "üèúÔ∏è" }
            ];
            
            return geoQuestions[Math.floor(Math.random() * geoQuestions.length)];
        }

        // Generate General Knowledge Questions Dynamically
        function generateGKQuestion() {
            const gkQuestions = [
                { question: "How many continents are there?", options: ["5", "6", "7", "8"], correct: 2, emoji: "üåç" },
                { question: "What is the largest mammal?", options: ["Elephant", "Blue Whale", "Giraffe", "Hippopotamus"], correct: 1, emoji: "üêã" },
                { question: "How many sides does a hexagon have?", options: ["5", "6", "7", "8"], correct: 1, emoji: "‚¨°" },
                { question: "What is the fastest land animal?", options: ["Lion", "Cheetah", "Leopard", "Tiger"], correct: 1, emoji: "üêÜ" },
                { question: "Which vitamin is produced when skin is exposed to sunlight?", options: ["Vitamin A", "Vitamin B", "Vitamin C", "Vitamin D"], correct: 3, emoji: "‚òÄÔ∏è" }
            ];
            
            return gkQuestions[Math.floor(Math.random() * gkQuestions.length)];
        }

        // Shuffle Array
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Show Gameplay Section
        function showGameplaySection() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById('gameplay').classList.remove('hidden');
            
            // Update game title based on mode
            const titles = {
                quick: 'Quick Quiz ‚ö°',
                marathon: 'Marathon Mode üèÉ',
                timeattack: 'Time Attack ‚è∞',
                survival: 'Survival Mode üíÄ',
                infinite: 'Infinite Mode ‚ôæÔ∏è',
                practice: 'Practice Mode üìö',
                puzzle: 'Puzzle Mode üß©',
                subject: 'Subject Quiz üìö'
            };
            
            document.getElementById('game-title').textContent = titles[gameState.currentGame.mode] || 'Quiz Game';
            document.getElementById('total-questions-display').textContent = gameState.currentGame.questions.length;
        }

        // Show Question
        function showQuestion() {
            const game = gameState.currentGame;
            const question = game.questions[game.currentQuestion];
            
            if (!question) {
                endGame();
                return;
            }
            
            // Update question display
            document.getElementById('question-emoji').textContent = question.emoji || '‚ùì';
            document.getElementById('current-question').textContent = question.question;
            document.getElementById('question-number').textContent = game.currentQuestion + 1;
            document.getElementById('current-score').textContent = game.score;
            
            // Update progress bar
            const progress = ((game.currentQuestion + 1) / game.questions.length) * 100;
            document.getElementById('progress-bar').style.width = progress + '%';
            
            // Create answer options
            const optionsContainer = document.getElementById('answer-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'game-button text-gray-800 font-semibold py-4 px-6 rounded-lg transition-all';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            // Start timer
            startQuestionTimer();
            
            // Hide feedback
            document.getElementById('answer-feedback').classList.add('hidden');
        }

        // Start Question Timer
        function startQuestionTimer() {
            const mode = gameState.currentGame.mode;
            let timeLimit = 30;
            
            if (mode === 'quick') timeLimit = 15;
            else if (mode === 'timeattack') timeLimit = 10;
            else if (mode === 'survival') timeLimit = 20;
            else if (mode === 'infinite') timeLimit = 45; // More time for infinite mode
            else if (mode === 'practice') timeLimit = 0; // No time limit for practice mode
            
            gameState.currentGame.timeLeft = timeLimit;
            
            if (timeLimit === 0) {
                // Practice mode - no timer
                document.getElementById('time-left').textContent = '‚àû';
                return;
            }
            
            document.getElementById('time-left').textContent = timeLimit;
            
            gameState.currentGame.timer = setInterval(() => {
                gameState.currentGame.timeLeft--;
                document.getElementById('time-left').textContent = gameState.currentGame.timeLeft;
                
                if (gameState.currentGame.timeLeft <= 0) {
                    clearInterval(gameState.currentGame.timer);
                    selectAnswer(-1); // Time's up, wrong answer
                }
            }, 1000);
        }

        // Select Answer
        function selectAnswer(selectedIndex) {
            if (!gameState.currentGame.isActive) return;
            
            clearInterval(gameState.currentGame.timer);
            
            const question = gameState.currentGame.questions[gameState.currentGame.currentQuestion];
            const buttons = document.querySelectorAll('#answer-options button');
            const feedback = document.getElementById('answer-feedback');
            
            // Disable all buttons
            buttons.forEach(btn => btn.disabled = true);
            
            let isCorrect = selectedIndex === question.correct;
            
            // Update button styles
            if (selectedIndex >= 0) {
                buttons[selectedIndex].classList.add(isCorrect ? 'correct-answer' : 'wrong-answer');
            }
            buttons[question.correct].classList.add('correct-answer');
            
            // Show feedback
            feedback.classList.remove('hidden');
            if (isCorrect) {
                feedback.textContent = 'üéâ Correct! Well done!';
                feedback.className = 'text-center mt-6 text-xl font-semibold text-green-600';
                gameState.currentGame.score += calculateScore();
                gameState.player.correctAnswers++;
                gameState.player.streak++;
                
                // Add celebration animation
                feedback.classList.add('celebration');
            } else {
                feedback.textContent = `‚ùå Wrong! Correct answer: ${question.options[question.correct]}`;
                feedback.className = 'text-center mt-6 text-xl font-semibold text-red-600';
                
                // Reset streak for survival mode
                if (gameState.currentGame.mode === 'survival') {
                    endGame();
                    return;
                }
                
                // Add shake animation
                feedback.classList.add('shake');
            }
            
            gameState.player.totalQuestions++;
            
            // Move to next question after delay
            setTimeout(() => {
                gameState.currentGame.currentQuestion++;
                
                // For infinite mode, generate more questions when needed
                if (gameState.currentGame.mode === 'infinite' && 
                    gameState.currentGame.currentQuestion >= gameState.currentGame.questions.length - 10) {
                    // Generate 50 more questions when we're near the end
                    const moreQuestions = generateDynamicQuestions(50, gameState.currentGame.subject, gameState.currentGame.level);
                    gameState.currentGame.questions.push(...moreQuestions);
                }
                
                if (gameState.currentGame.currentQuestion < gameState.currentGame.questions.length) {
                    showQuestion();
                } else {
                    endGame();
                }
            }, 2000);
        }

        // Calculate Score
        function calculateScore() {
            const timeBonus = Math.max(0, gameState.currentGame.timeLeft);
            const baseScore = 100;
            return baseScore + timeBonus;
        }

        // End Game
        function endGame() {
            gameState.currentGame.isActive = false;
            clearInterval(gameState.currentGame.timer);
            
            // Update player stats
            gameState.player.gamesPlayed++;
            gameState.player.coins += Math.floor(gameState.currentGame.score / 10);
            gameState.player.totalScore += gameState.currentGame.score;
            if (gameState.currentGame.score > gameState.player.bestScore) {
                gameState.player.bestScore = gameState.currentGame.score;
            }
            
            // Level up check
            const newLevel = Math.floor(gameState.player.coins / 1000) + 1;
            if (newLevel > gameState.player.level) {
                gameState.player.level = newLevel;
                showLevelUpAnimation();
            }
            
            // Add to recent activity
            gameState.player.recentActivity.unshift({
                mode: gameState.currentGame.mode,
                score: gameState.currentGame.score,
                accuracy: Math.round((gameState.player.correctAnswers / gameState.player.totalQuestions) * 100),
                date: new Date().toLocaleDateString()
            });
            
            // Keep only last 10 activities
            if (gameState.player.recentActivity.length > 10) {
                gameState.player.recentActivity = gameState.player.recentActivity.slice(0, 10);
            }
            
            // Check for new achievements
            checkAchievements();
            
            // Save state
            saveGameState();
            updateUI();
            
            // Show results
            showGameResults();
        }

        // Show Game Results
        function showGameResults() {
            document.getElementById('gameplay').classList.add('hidden');
            document.getElementById('game-results').classList.remove('hidden');
            
            const game = gameState.currentGame;
            const correctCount = gameState.player.correctAnswers;
            const totalQuestions = game.questions.length;
            const wrongCount = totalQuestions - correctCount;
            const accuracy = Math.round((correctCount / totalQuestions) * 100);
            
            // Update result display
            document.getElementById('final-score').textContent = game.score;
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('wrong-count').textContent = wrongCount;
            document.getElementById('accuracy-percentage').textContent = accuracy + '%';
            
            // Set result emoji and title based on performance
            let emoji, title;
            if (accuracy >= 90) {
                emoji = 'üèÜ';
                title = 'Outstanding Performance!';
            } else if (accuracy >= 70) {
                emoji = 'üéâ';
                title = 'Great Job!';
            } else if (accuracy >= 50) {
                emoji = 'üëç';
                title = 'Good Effort!';
            } else {
                emoji = 'üìö';
                title = 'Keep Learning!';
            }
            
            document.getElementById('result-emoji').textContent = emoji;
            document.getElementById('result-title').textContent = title;
            
            // Show rewards
            showRewards();
        }

        // Show Rewards
        function showRewards() {
            const rewardsContainer = document.getElementById('rewards-earned');
            const coinsEarned = Math.floor(gameState.currentGame.score / 10);
            
            rewardsContainer.innerHTML = `
                <div class="bg-yellow-100 rounded-lg p-4 text-center">
                    <div class="text-2xl">üèÜ</div>
                    <div class="font-bold text-yellow-800">${coinsEarned} Coins</div>
                </div>
            `;
            
            // Add level up reward if applicable
            if (gameState.player.level > 1) {
                rewardsContainer.innerHTML += `
                    <div class="bg-purple-100 rounded-lg p-4 text-center">
                        <div class="text-2xl">‚≠ê</div>
                        <div class="font-bold text-purple-800">Level ${gameState.player.level}</div>
                    </div>
                `;
            }
        }

        // Check Achievements
        function checkAchievements() {
            const achievements = [
                { id: 'first_game', name: 'First Steps', description: 'Played your first game', condition: () => gameState.player.gamesPlayed >= 1 },
                { id: 'score_master', name: 'Score Master', description: 'Scored 1000+ points in a game', condition: () => gameState.currentGame.score >= 1000 },
                { id: 'accuracy_expert', name: 'Accuracy Expert', description: '90%+ accuracy', condition: () => (gameState.player.correctAnswers / gameState.player.totalQuestions) >= 0.9 },
                { id: 'game_addict', name: 'Game Addict', description: 'Played 10 games', condition: () => gameState.player.gamesPlayed >= 10 },
                { id: 'coin_collector', name: 'Coin Collector', description: 'Collected 500 coins', condition: () => gameState.player.coins >= 500 }
            ];
            
            achievements.forEach(achievement => {
                if (!gameState.player.achievements.includes(achievement.id) && achievement.condition()) {
                    gameState.player.achievements.push(achievement.id);
                    showAchievementUnlocked(achievement);
                }
            });
        }

        // Show Achievement Unlocked
        function showAchievementUnlocked(achievement) {
            // Create achievement notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-4 rounded-lg shadow-lg z-50 bounce-scale';
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">üèÜ</div>
                    <div>
                        <div class="font-bold">Achievement Unlocked!</div>
                        <div class="text-sm">${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize Achievements
        function initializeAchievements() {
            const achievementsGrid = document.getElementById('achievements-grid');
            const allAchievements = [
                { id: 'first_game', name: 'First Steps', description: 'Played your first game', icon: 'üéØ' },
                { id: 'score_master', name: 'Score Master', description: 'Scored 1000+ points in a game', icon: 'üèÜ' },
                { id: 'accuracy_expert', name: 'Accuracy Expert', description: '90%+ accuracy', icon: 'üé™' },
                { id: 'game_addict', name: 'Game Addict', description: 'Played 10 games', icon: 'üéÆ' },
                { id: 'coin_collector', name: 'Coin Collector', description: 'Collected 500 coins', icon: 'üí∞' },
                { id: 'streak_master', name: 'Streak Master', description: '10 correct answers in a row', icon: 'üî•' }
            ];
            
            achievementsGrid.innerHTML = allAchievements.map(achievement => {
                const earned = gameState.player.achievements.includes(achievement.id);
                return `
                    <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 text-center ${earned ? 'glow-effect' : 'opacity-50'}">
                        <div class="text-4xl mb-3">${achievement.icon}</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${achievement.name}</h3>
                        <p class="text-gray-600 mb-4">${achievement.description}</p>
                        <div class="text-sm font-semibold ${earned ? 'text-green-600' : 'text-gray-500'}">
                            ${earned ? '‚úÖ Unlocked' : 'üîí Locked'}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize Profile
        function initializeProfile() {
            const profileStats = document.getElementById('profile-stats');
            const recentActivity = document.getElementById('recent-activity');
            
            // Update profile stats
            profileStats.innerHTML = `
                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="flex justify-between">
                        <span class="text-gray-700">Games Played</span>
                        <span class="font-bold text-blue-600">${gameState.player.gamesPlayed}</span>
                    </div>
                </div>
                <div class="bg-green-50 rounded-lg p-4">
                    <div class="flex justify-between">
                        <span class="text-gray-700">Total Coins</span>
                        <span class="font-bold text-green-600">${gameState.player.coins}</span>
                    </div>
                </div>
                <div class="bg-purple-50 rounded-lg p-4">
                    <div class="flex justify-between">
                        <span class="text-gray-700">Current Level</span>
                        <span class="font-bold text-purple-600">${gameState.player.level}</span>
                    </div>
                </div>
                <div class="bg-orange-50 rounded-lg p-4">
                    <div class="flex justify-between">
                        <span class="text-gray-700">Best Streak</span>
                        <span class="font-bold text-orange-600">${gameState.player.streak}</span>
                    </div>
                </div>
            `;
            
            // Update recent activity
            if (gameState.player.recentActivity.length > 0) {
                recentActivity.innerHTML = gameState.player.recentActivity.map(activity => `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-semibold text-gray-800">${activity.mode.toUpperCase()} Mode</div>
                                <div class="text-sm text-gray-600">${activity.date}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-blue-600">${activity.score} pts</div>
                                <div class="text-sm text-gray-600">${activity.accuracy}% accuracy</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } else {
                recentActivity.innerHTML = '<div class="text-gray-500 text-center">No recent activity</div>';
            }
        }

        // Game Control Functions
        function pauseGame() {
            if (gameState.currentGame.isActive) {
                clearInterval(gameState.currentGame.timer);
                gameState.currentGame.isActive = false;
                alert('Game Paused! Click OK to resume.');
                gameState.currentGame.isActive = true;
                startQuestionTimer();
            }
        }

        function quitGame() {
            if (confirm('Are you sure you want to quit the game?')) {
                clearInterval(gameState.currentGame.timer);
                gameState.currentGame.isActive = false;
                showSection('home');
            }
        }

        function playAgain() {
            startGame();
        }

        function shareResults() {
            const text = `I just scored ${gameState.currentGame.score} points in Educational Game! üéÆüìö #EducationalGame #Learning`;
            if (navigator.share) {
                navigator.share({
                    title: 'Educational Game Results',
                    text: text,
                    url: window.location.href
                });
            } else {
                // Fallback for browsers that don't support Web Share API
                navigator.clipboard.writeText(text).then(() => {
                    alert('Results copied to clipboard!');
                });
            }
        }

        // Show Leaderboard
        function showLeaderboard(tab) {
            gameState.leaderboard.currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.leaderboard-tab').forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-purple-500');
                btn.classList.add('bg-transparent');
            });
            
            event.target.classList.remove('bg-transparent');
            event.target.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-purple-500');
            
            // Update leaderboard content
            updateLeaderboardContent(tab);
        }

        // Update Leaderboard Content
        function updateLeaderboardContent(tab) {
            const content = document.getElementById('leaderboard-content');
            const leaderboardData = generateLeaderboardData();
            
            if (tab === 'overall') {
                if (leaderboardData.overall.length === 0) {
                    content.innerHTML = '<div class="text-center py-12"><div class="text-6xl mb-4">üèÜ</div><h3 class="text-2xl font-bold text-gray-800 mb-2">No Players Yet!</h3><p class="text-gray-600">Be the first to play games and appear on the leaderboard!</p></div>';
                } else {
                    content.innerHTML = generateLeaderboardTable(leaderboardData.overall, 'overall');
                }
            } else if (tab === 'weekly') {
                if (leaderboardData.weekly.length === 0) {
                    content.innerHTML = '<div class="text-center py-12"><div class="text-6xl mb-4">üìÖ</div><h3 class="text-2xl font-bold text-gray-800 mb-2">No Weekly Activity!</h3><p class="text-gray-600">Play some games to see weekly rankings!</p></div>';
                } else {
                    content.innerHTML = generateLeaderboardTable(leaderboardData.weekly, 'weekly');
                }
            } else if (tab === 'subject') {
                content.innerHTML = generateSubjectLeaderboard(leaderboardData);
            }
        }

        // Generate Leaderboard Table
        function generateLeaderboardTable(data, type) {
            const headers = type === 'overall' ? 
                ['Rank', 'Player', 'Total Score', 'Level', 'Games', 'Accuracy'] :
                ['Rank', 'Player', 'Weekly Score', 'Level', 'Games', 'Accuracy'];
                
            let html = `
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b-2 border-gray-200">
                                ${headers.map(header => `<th class="text-left py-4 px-4 font-bold text-gray-800">${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            data.forEach((player, index) => {
                const rank = index + 1;
                let rankDisplay = `#${rank}`;
                let rankClass = 'text-gray-600';
                
                if (rank === 1) {
                    rankDisplay = 'ü•á';
                    rankClass = 'text-yellow-500';
                } else if (rank === 2) {
                    rankDisplay = 'ü•à';
                    rankClass = 'text-gray-400';
                } else if (rank === 3) {
                    rankDisplay = 'ü•â';
                    rankClass = 'text-orange-500';
                }
                
                html += `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                        <td class="py-4 px-4">
                            <span class="text-2xl font-bold ${rankClass}">${rankDisplay}</span>
                        </td>
                        <td class="py-4 px-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 rounded-full overflow-hidden flex items-center justify-center bg-gray-100">
                                    ${player.avatar && player.avatar.startsWith('data:image') ? 
                                        `<img src="${player.avatar}" alt="Profile" class="w-full h-full object-cover">` : 
                                        `<span class="text-2xl">${player.avatar}</span>`
                                    }
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">${player.name}</div>
                                    <div class="text-sm text-gray-600">Level ${player.level}</div>
                                </div>
                            </div>
                        </td>
                        <td class="py-4 px-4">
                            <div class="font-bold text-blue-600">${player.score.toLocaleString()}</div>
                        </td>
                        <td class="py-4 px-4">
                            <div class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold">
                                Level ${player.level}
                            </div>
                        </td>
                        <td class="py-4 px-4">
                            <div class="text-gray-700">${player.games}</div>
                        </td>
                        <td class="py-4 px-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: ${player.accuracy}%"></div>
                                </div>
                                <span class="text-sm font-semibold text-green-600">${player.accuracy}%</span>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return html;
        }

        // Generate Subject Leaderboard
        function generateSubjectLeaderboard(leaderboardData) {
            if (!leaderboardData || leaderboardData.overall.length === 0) {
                return '<div class="text-center py-12"><div class="text-6xl mb-4">üìö</div><h3 class="text-2xl font-bold text-gray-800 mb-2">No Subject Data Yet!</h3><p class="text-gray-600">Play subject-specific games to see subject rankings!</p></div>';
            }
            
            return `
                <div class="space-y-8">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-3xl mr-3">üßÆ</span>
                            Mathematics Champions
                        </h3>
                        ${generateSubjectTable(leaderboardData.subjects.math)}
                    </div>
                    
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-3xl mr-3">üî¨</span>
                            Science Masters
                        </h3>
                        ${generateSubjectTable(leaderboardData.subjects.science)}
                    </div>
                    
                    <div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                            <span class="text-3xl mr-3">üìù</span>
                            English Experts
                        </h3>
                        ${generateSubjectTable(leaderboardData.subjects.english)}
                    </div>
                </div>
            `;
        }

        // Generate Subject Table
        function generateSubjectTable(data) {
            if (!data || data.length === 0) {
                return `
                    <div class="bg-gray-50 rounded-lg p-8 text-center">
                        <div class="text-4xl mb-3">üéØ</div>
                        <div class="text-gray-600">No players in this subject yet!</div>
                        <div class="text-sm text-gray-500 mt-2">Play some games to appear here</div>
                    </div>
                `;
            }
            
            let html = `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="grid gap-3">
            `;
            
            data.forEach((player, index) => {
                const rank = index + 1;
                let medal = '';
                if (rank === 1) medal = 'ü•á';
                else if (rank === 2) medal = 'ü•à';
                else if (rank === 3) medal = 'ü•â';
                
                html += `
                    <div class="flex items-center justify-between bg-white rounded-lg p-4 shadow-sm">
                        <div class="flex items-center space-x-4">
                            <div class="text-2xl">${medal || `#${rank}`}</div>
                            <div class="w-10 h-10 rounded-full overflow-hidden flex items-center justify-center bg-gray-100">
                                ${player.avatar && player.avatar.startsWith('data:image') ? 
                                    `<img src="${player.avatar}" alt="Profile" class="w-full h-full object-cover">` : 
                                    `<span class="text-xl">${player.avatar}</span>`
                                }
                            </div>
                            <div>
                                <div class="font-semibold text-gray-800">${player.name}</div>
                                <div class="text-sm text-gray-600">${player.games} games played</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-blue-600">${player.score.toLocaleString()}</div>
                            <div class="text-sm text-green-600">${player.accuracy}% accuracy</div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }

        // Initialize Leaderboard
        function initializeLeaderboard() {
            // Update player's rank and score
            const playerTotalScore = gameState.player.totalScore || 0;
            document.getElementById('player-total-score').textContent = playerTotalScore.toLocaleString() + ' pts';
            
            // Calculate player's actual rank
            const leaderboardData = generateLeaderboardData();
            let playerRank = 'Unranked';
            
            if (gameState.isLoggedIn && gameState.currentUser) {
                const playerIndex = leaderboardData.overall.findIndex(player => 
                    player.username === gameState.currentUser.username
                );
                
                if (playerIndex !== -1) {
                    playerRank = '#' + (playerIndex + 1);
                } else if (gameState.player.gamesPlayed === 0) {
                    playerRank = 'Play games to get ranked!';
                }
            } else {
                playerRank = 'Login to see rank';
            }
            
            document.getElementById('player-rank').textContent = playerRank;
            
            // Show default leaderboard
            updateLeaderboardContent(gameState.leaderboard.currentTab);
        }

        // Authentication Functions
        function showLogin() {
            document.getElementById('login-modal').classList.remove('hidden');
        }

        function showRegister() {
            document.getElementById('register-modal').classList.remove('hidden');
        }

        function showForgotPassword() {
            closeModal('login-modal');
            document.getElementById('forgot-password-modal').classList.remove('hidden');
        }

        function switchToRegister() {
            closeModal('login-modal');
            showRegister();
        }

        function switchToLogin() {
            closeModal('register-modal');
            closeModal('forgot-password-modal');
            showLogin();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function closeWelcomeModal() {
            closeModal('welcome-modal');
            showSection('home');
        }

        // Handle Login Form
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const usernameOrEmail = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                const rememberMe = document.getElementById('remember-me').checked;
                
                if (!usernameOrEmail || !password) {
                    showError('Please enter both username/email and password');
                    return;
                }
                
                // Find user by username or email
                let user = findUserByUsername(usernameOrEmail);
                if (!user) {
                    user = findUserByEmail(usernameOrEmail);
                }
                
                if (!user) {
                    showError('User not found! Please register first.');
                    // Shake the form
                    document.getElementById('login-modal').querySelector('.slide-up').classList.add('shake');
                    setTimeout(() => {
                        document.getElementById('login-modal').querySelector('.slide-up').classList.remove('shake');
                    }, 500);
                    return;
                }
                
                // Check password
                if (user.password !== password) {
                    showError('Incorrect password! Please try again.');
                    // Shake the form
                    document.getElementById('login-modal').querySelector('.slide-up').classList.add('shake');
                    setTimeout(() => {
                        document.getElementById('login-modal').querySelector('.slide-up').classList.remove('shake');
                    }, 500);
                    return;
                }
                
                // Successful login
                loginUser(user, rememberMe);
                closeModal('login-modal');
                showLoginSuccess();
            });

            // Handle Register Form
            document.getElementById('register-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('register-name').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                const ageGroup = document.getElementById('register-age').value;
                const agreeTerms = document.getElementById('agree-terms').checked;
                
                // Validation
                if (!name || !email || !username || !password || !ageGroup) {
                    showError('Please fill all required fields');
                    return;
                }
                
                if (!agreeTerms) {
                    showError('Please agree to the terms and conditions');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showError('Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    showError('Password must be at least 6 characters long');
                    return;
                }
                
                // Check if username already exists
                if (findUserByUsername(username)) {
                    showError('Username already exists! Please choose a different one.');
                    return;
                }
                
                // Check if email already exists
                if (findUserByEmail(email)) {
                    showError('Email already registered! Please use a different email.');
                    return;
                }
                
                // Email format validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showError('Please enter a valid email address');
                    return;
                }
                
                // Username validation (no spaces, special characters)
                const usernameRegex = /^[a-zA-Z0-9_]+$/;
                if (!usernameRegex.test(username)) {
                    showError('Username can only contain letters, numbers, and underscores');
                    return;
                }
                
                if (username.length < 3) {
                    showError('Username must be at least 3 characters long');
                    return;
                }
                
                // Create new user
                const userData = {
                    playerName: name,
                    email: email,
                    username: username,
                    password: password, // In real app, this should be hashed
                    ageGroup: ageGroup,
                    avatar: getRandomAvatar(),
                    joinDate: new Date().toISOString()
                };
                
                // Save user to database
                saveUserToDatabase(userData);
                
                registerUser(userData);
                closeModal('register-modal');
                showWelcomeModal();
            });

            // Handle Forgot Password Form
            document.getElementById('forgot-password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('forgot-email').value.trim();
                
                if (!email) {
                    showError('Please enter your email address');
                    return;
                }
                
                // Email format validation
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showError('Please enter a valid email address');
                    return;
                }
                
                // Check if email exists in database
                const user = findUserByEmail(email);
                if (!user) {
                    showError('No account found with this email address');
                    return;
                }
                
                // In a real app, you would send an actual email
                // For demo purposes, we'll show the password (NOT recommended in production)
                showSuccess(`Password reset info sent! Your password is: ${user.password}`);
                closeModal('forgot-password-modal');
            });
        });

        // Login User
        function loginUser(userData, rememberMe) {
            gameState.isLoggedIn = true;
            gameState.currentUser = userData;
            
            // Update player data
            gameState.player.playerName = userData.playerName;
            gameState.player.email = userData.email;
            gameState.player.username = userData.username;
            gameState.player.avatar = userData.avatar;
            gameState.player.ageGroup = userData.ageGroup;
            gameState.player.joinDate = userData.joinDate;
            
            // Load existing user data if available
            const savedUserData = localStorage.getItem('eduGameUser_' + userData.username);
            if (savedUserData) {
                const saved = JSON.parse(savedUserData);
                gameState.player = { ...gameState.player, ...saved };
            }
            
            updateAuthUI();
            saveGameState();
            
            if (rememberMe) {
                localStorage.setItem('eduGameRememberUser', JSON.stringify({
                    username: userData.username,
                    password: userData.password
                }));
            }
        }

        // Register User
        function registerUser(userData) {
            gameState.isLoggedIn = true;
            gameState.currentUser = userData;
            
            // Set initial player data for new user
            gameState.player = {
                ...gameState.player,
                playerName: userData.playerName,
                email: userData.email,
                username: userData.username,
                avatar: userData.avatar,
                ageGroup: userData.ageGroup,
                joinDate: userData.joinDate,
                coins: 100, // Welcome bonus
                achievements: ['first_steps'] // Welcome achievement
            };
            
            updateAuthUI();
            saveGameState();
        }

        // Logout User
        function logout() {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§µ‡§æ‡§ï‡§à logout ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç? üö™')) {
                // Save current user data before logout
                if (gameState.isLoggedIn && gameState.currentUser) {
                    saveGameState();
                }
                
                // Clear current session
                gameState.isLoggedIn = false;
                gameState.currentUser = null;
                
                // Reset to guest state
                gameState.player = {
                    coins: 0,
                    level: 1,
                    streak: 0,
                    gamesPlayed: 0,
                    correctAnswers: 0,
                    totalQuestions: 0,
                    achievements: [],
                    recentActivity: [],
                    totalScore: 0,
                    bestScore: 0,
                    playerName: 'Guest',
                    email: '',
                    username: '',
                    avatar: 'üë§',
                    ageGroup: '',
                    joinDate: null
                };
                
                // Clear remember me data
                localStorage.removeItem('eduGameRememberUser');
                
                // Clear any ongoing game
                if (gameState.currentGame.isActive) {
                    clearInterval(gameState.currentGame.timer);
                    gameState.currentGame.isActive = false;
                }
                
                // Update UI
                updateAuthUI();
                showSection('home');
                
                // Close user dropdown if open
                const userDropdown = document.getElementById('user-dropdown');
                if (userDropdown) {
                    userDropdown.classList.add('hidden');
                }
                
                // Show logout success message
                showSuccess('Successfully logged out! ‡§Ü‡§™‡§ï‡§æ data safe ‡§π‡•à‡•§ üëã');
            }
        }

        // Update Authentication UI
        function updateAuthUI() {
            const userStats = document.getElementById('user-stats');
            const authButtons = document.getElementById('auth-buttons');
            const userDisplayName = document.getElementById('user-display-name');
            const userAvatar = document.getElementById('user-avatar');
            const dropdownUserName = document.getElementById('dropdown-user-name');
            const dropdownUserAvatar = document.getElementById('dropdown-user-avatar');
            
            if (gameState.isLoggedIn) {
                userStats.classList.remove('hidden');
                authButtons.classList.add('hidden');
                userDisplayName.textContent = gameState.player.playerName;
                
                // Update header avatar
                const userAvatarContainer = document.getElementById('user-avatar-container');
                if (gameState.player.avatar && gameState.player.avatar.startsWith('data:image')) {
                    userAvatarContainer.innerHTML = `<img src="${gameState.player.avatar}" alt="Profile" class="w-full h-full object-cover rounded-full">`;
                } else {
                    userAvatarContainer.innerHTML = `<div class="text-2xl" id="user-avatar">${gameState.player.avatar}</div>`;
                }
                
                // Update dropdown avatar
                if (dropdownUserName) dropdownUserName.textContent = gameState.player.playerName;
                const dropdownAvatarContainer = document.getElementById('dropdown-user-avatar-container');
                if (dropdownAvatarContainer) {
                    if (gameState.player.avatar && gameState.player.avatar.startsWith('data:image')) {
                        dropdownAvatarContainer.innerHTML = `<img src="${gameState.player.avatar}" alt="Profile" class="w-full h-full object-cover rounded-full">`;
                    } else {
                        dropdownAvatarContainer.innerHTML = `<span id="dropdown-user-avatar">${gameState.player.avatar}</span>`;
                    }
                }
                
                // Update other users list in dropdown
                updateOtherUsersList();
            } else {
                userStats.classList.add('hidden');
                authButtons.classList.remove('hidden');
            }
            
            updateUI();
        }

        // Update Other Users List in Dropdown
        function updateOtherUsersList() {
            const otherUsersList = document.getElementById('other-users-list');
            if (!otherUsersList) return;
            
            const allUsers = getAllUsers();
            const currentUsername = gameState.currentUser ? gameState.currentUser.username : '';
            const otherUsers = allUsers.filter(user => user.username !== currentUsername);
            
            if (otherUsers.length === 0) {
                otherUsersList.innerHTML = '<div class="text-gray-500 text-sm">No other users</div>';
                return;
            }
            
            otherUsersList.innerHTML = otherUsers.map(user => `
                <button class="w-full text-left px-2 py-1 text-sm text-gray-700 hover:bg-gray-100 rounded transition-colors flex items-center space-x-2" onclick="switchToUser('${user.username}')">
                    <div class="w-6 h-6 rounded-full overflow-hidden flex items-center justify-center bg-gray-100">
                        ${user.avatar && user.avatar.startsWith('data:image') ? 
                            `<img src="${user.avatar}" alt="Profile" class="w-full h-full object-cover">` : 
                            `<span class="text-sm">${user.avatar}</span>`
                        }
                    </div>
                    <span>${user.playerName}</span>
                </button>
            `).join('');
        }

        // Switch to User
        let pendingSwitchUser = null;
        
        function switchToUser(username) {
            const user = findUserByUsername(username);
            if (!user) {
                showError('User not found!');
                return;
            }
            
            pendingSwitchUser = user;
            document.getElementById('switch-to-user-name').textContent = user.playerName;
            document.getElementById('switch-user-modal').classList.remove('hidden');
            
            // Close user dropdown
            document.getElementById('user-dropdown').classList.add('hidden');
        }

        // Confirm Switch User
        function confirmSwitchUser() {
            if (!pendingSwitchUser) return;
            
            // Save current user data
            if (gameState.isLoggedIn && gameState.currentUser) {
                saveGameState();
            }
            
            // Switch to new user
            loginUser(pendingSwitchUser, false);
            
            closeModal('switch-user-modal');
            showSuccess(`Switched to ${pendingSwitchUser.playerName}! üîÑ`);
            
            pendingSwitchUser = null;
        }

        // Show Add User Option
        function showAddUserOption() {
            document.getElementById('user-dropdown').classList.add('hidden');
            showRegister();
        }

        // Show User Manager
        function showUserManager() {
            document.getElementById('user-dropdown').classList.add('hidden');
            document.getElementById('user-manager-modal').classList.remove('hidden');
            updateUserManagerContent();
        }

        // Update User Manager Content
        function updateUserManagerContent() {
            const allUsers = getAllUsers();
            
            // Update statistics
            document.getElementById('total-users-count').textContent = allUsers.length;
            document.getElementById('active-users-count').textContent = allUsers.filter(user => {
                const userData = localStorage.getItem('eduGameUser_' + user.username);
                return userData && JSON.parse(userData).gamesPlayed > 0;
            }).length;
            
            let totalGames = 0;
            allUsers.forEach(user => {
                const userData = localStorage.getItem('eduGameUser_' + user.username);
                if (userData) {
                    totalGames += JSON.parse(userData).gamesPlayed || 0;
                }
            });
            document.getElementById('total-games-played').textContent = totalGames;
            
            // Update users table
            const tableBody = document.getElementById('users-table-body');
            if (allUsers.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="text-center py-8 text-gray-500">No users registered yet</td></tr>';
                return;
            }
            
            tableBody.innerHTML = allUsers.map(user => {
                const userData = localStorage.getItem('eduGameUser_' + user.username);
                const gameData = userData ? JSON.parse(userData) : { level: 1, coins: 0, gamesPlayed: 0 };
                const joinDate = new Date(user.joinDate).toLocaleDateString();
                const isCurrentUser = gameState.currentUser && gameState.currentUser.username === user.username;
                
                return `
                    <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors ${isCurrentUser ? 'bg-blue-50' : ''}">
                        <td class="py-3 px-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 rounded-full overflow-hidden flex items-center justify-center bg-gray-100">
                                    ${user.avatar && user.avatar.startsWith('data:image') ? 
                                        `<img src="${user.avatar}" alt="Profile" class="w-full h-full object-cover">` : 
                                        `<span class="text-xl">${user.avatar}</span>`
                                    }
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">${user.playerName} ${isCurrentUser ? '(Current)' : ''}</div>
                                    <div class="text-sm text-gray-600">@${user.username}</div>
                                </div>
                            </div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-sm font-semibold inline-block">
                                Level ${gameData.level}
                            </div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="font-bold text-yellow-600">${gameData.coins || 0}</div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="text-gray-700">${gameData.gamesPlayed || 0}</div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="text-sm text-gray-600">${joinDate}</div>
                        </td>
                        <td class="py-3 px-4">
                            <div class="flex space-x-2">
                                ${!isCurrentUser ? `
                                    <button class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition-colors" onclick="switchToUser('${user.username}')">
                                        Switch
                                    </button>
                                ` : ''}
                                <button class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors" onclick="deleteUser('${user.username}', '${user.playerName}')">
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Delete User
        function deleteUser(username, playerName) {
            if (gameState.currentUser && gameState.currentUser.username === username) {
                showError('Cannot delete the currently logged-in user!');
                return;
            }
            
            if (confirm(`Are you sure you want to delete user "${playerName}"? This action cannot be undone.`)) {
                deleteUserFromDatabase(username);
                updateUserManagerContent();
                updateOtherUsersList();
                showSuccess(`User "${playerName}" has been deleted successfully.`);
            }
        }

        // Show Welcome Modal
        function showWelcomeModal() {
            document.getElementById('welcome-modal').classList.remove('hidden');
        }

        // User Database Functions
        function saveUserToDatabase(userData) {
            // Get existing users from localStorage
            let users = JSON.parse(localStorage.getItem('eduGameUsers') || '[]');
            
            // Add new user
            users.push(userData);
            
            // Save back to localStorage
            localStorage.setItem('eduGameUsers', JSON.stringify(users));
        }

        function findUserByUsername(username) {
            const users = JSON.parse(localStorage.getItem('eduGameUsers') || '[]');
            return users.find(user => user.username.toLowerCase() === username.toLowerCase());
        }

        function findUserByEmail(email) {
            const users = JSON.parse(localStorage.getItem('eduGameUsers') || '[]');
            return users.find(user => user.email.toLowerCase() === email.toLowerCase());
        }

        function getAllUsers() {
            return JSON.parse(localStorage.getItem('eduGameUsers') || '[]');
        }

        function updateUserInDatabase(userData) {
            let users = JSON.parse(localStorage.getItem('eduGameUsers') || '[]');
            const userIndex = users.findIndex(user => user.username === userData.username);
            
            if (userIndex !== -1) {
                users[userIndex] = { ...users[userIndex], ...userData };
                localStorage.setItem('eduGameUsers', JSON.stringify(users));
            }
        }

        function deleteUserFromDatabase(username) {
            let users = JSON.parse(localStorage.getItem('eduGameUsers') || '[]');
            users = users.filter(user => user.username !== username);
            localStorage.setItem('eduGameUsers', JSON.stringify(users));
            
            // Also remove user's game data
            localStorage.removeItem('eduGameUser_' + username);
        }

        // Get Random Avatar
        function getRandomAvatar() {
            const avatars = ['üë§', 'üßë', 'üë©', 'üßí', 'üë¶', 'üëß', 'üßë‚Äçüéì', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'ü§ì', 'üòä', 'üåü', 'üéØ', 'üöÄ', 'üíé', 'üî•', '‚ö°', 'üé™', 'üé®', 'üåà'];
            return avatars[Math.floor(Math.random() * avatars.length)];
        }

        // Show Success Message
        function showSuccess(message) {
            showNotification(message, 'success');
        }

        // Show Error Message
        function showError(message) {
            showNotification(message, 'error');
        }

        // Show Notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'from-green-500 to-teal-500' : 'from-red-500 to-pink-500';
            const icon = type === 'success' ? '‚úÖ' : '‚ùå';
            
            notification.className = `fixed top-20 right-4 bg-gradient-to-r ${bgColor} text-white p-4 rounded-lg shadow-lg z-50 bounce-scale`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">${icon}</div>
                    <div class="font-semibold">${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Show Login Success
        function showLoginSuccess() {
            showSuccess(`Welcome back, ${gameState.player.playerName}! üéâ`);
        }

        // Show Settings
        function showSettings() {
            document.getElementById('user-dropdown').classList.add('hidden');
            document.getElementById('settings-modal').classList.remove('hidden');
            updateSettingsContent();
        }

        // Show Device Info
        function showDeviceInfo() {
            document.getElementById('user-dropdown').classList.add('hidden');
            document.getElementById('device-info-modal').classList.remove('hidden');
            updateDeviceInfoContent();
        }

        // Update Device Info Content
        function updateDeviceInfoContent() {
            const deviceId = getCurrentDeviceId();
            const deviceUsers = getAllDeviceUsers();
            
            // Update device ID
            document.getElementById('current-device-id').textContent = deviceId.substring(0, 12) + '...';
            
            // Update device users count
            document.getElementById('device-users-count').textContent = deviceUsers.length;
            
            // Update browser info
            const browserInfo = getBrowserInfo();
            document.getElementById('browser-info').textContent = browserInfo;
            
            // Update screen info
            document.getElementById('screen-info').textContent = `${screen.width}√ó${screen.height}`;
            
            // Update device users list
            const deviceUsersList = document.getElementById('device-users-list');
            if (deviceUsers.length === 0) {
                deviceUsersList.innerHTML = '<div class="text-gray-500 text-center py-4">No users on this device</div>';
                return;
            }
            
            deviceUsersList.innerHTML = deviceUsers.map(user => {
                const isCurrentUser = gameState.currentUser && gameState.currentUser.username === user.username;
                const addedDate = user.addedToDeviceOn ? new Date(user.addedToDeviceOn).toLocaleDateString() : 'Unknown';
                
                return `
                    <div class="flex items-center justify-between bg-white rounded-lg p-3 ${isCurrentUser ? 'ring-2 ring-blue-500' : ''}">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full overflow-hidden flex items-center justify-center bg-gray-100">
                                ${user.avatar && user.avatar.startsWith('data:image') ? 
                                    `<img src="${user.avatar}" alt="Profile" class="w-full h-full object-cover">` : 
                                    `<span class="text-xl">${user.avatar}</span>`
                                }
                            </div>
                            <div>
                                <div class="font-semibold text-gray-800">${user.playerName} ${isCurrentUser ? '(Current)' : ''}</div>
                                <div class="text-sm text-gray-600">@${user.username}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm text-gray-600">Added: ${addedDate}</div>
                            <div class="text-xs text-gray-500">${user.email}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Get Browser Info
        function getBrowserInfo() {
            const userAgent = navigator.userAgent;
            let browserName = 'Unknown';
            
            if (userAgent.includes('Chrome')) browserName = 'Chrome';
            else if (userAgent.includes('Firefox')) browserName = 'Firefox';
            else if (userAgent.includes('Safari')) browserName = 'Safari';
            else if (userAgent.includes('Edge')) browserName = 'Edge';
            else if (userAgent.includes('Opera')) browserName = 'Opera';
            
            return browserName;
        }

        // User Menu Toggle
        document.addEventListener('DOMContentLoaded', function() {
            const userMenuBtn = document.getElementById('user-menu-btn');
            const userDropdown = document.getElementById('user-dropdown');
            
            if (userMenuBtn && userDropdown) {
                userMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    userDropdown.classList.toggle('hidden');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function() {
                    userDropdown.classList.add('hidden');
                });
                
                userDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });

        // Check for remembered user on load
        function checkRememberedUser() {
            const rememberedUser = localStorage.getItem('eduGameRememberUser');
            if (rememberedUser) {
                const loginData = JSON.parse(rememberedUser);
                const userData = findUserByUsername(loginData.username);
                
                if (userData && userData.password === loginData.password) {
                    loginUser(userData, true);
                } else {
                    // Remove invalid remembered user
                    localStorage.removeItem('eduGameRememberUser');
                }
            }
        }

        // Add Enter key support for forms
        function addEnterKeySupport() {
            // Login form Enter key support
            const loginInputs = document.querySelectorAll('#login-modal input');
            loginInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('login-form').dispatchEvent(new Event('submit'));
                    }
                });
            });

            // Register form Enter key support
            const registerInputs = document.querySelectorAll('#register-modal input, #register-modal select');
            registerInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('register-form').dispatchEvent(new Event('submit'));
                    }
                });
            });

            // Forgot password form Enter key support
            const forgotInputs = document.querySelectorAll('#forgot-password-modal input');
            forgotInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('forgot-password-form').dispatchEvent(new Event('submit'));
                    }
                });
            });
        }

        // Update Settings Content
        function updateSettingsContent() {
            if (!gameState.isLoggedIn || !gameState.currentUser) {
                showError('Please login first to access settings!');
                closeModal('settings-modal');
                return;
            }
            
            // Update current profile photo
            const currentPhotoElement = document.getElementById('current-profile-photo');
            if (gameState.player.avatar && gameState.player.avatar.startsWith('data:image')) {
                currentPhotoElement.innerHTML = `<img src="${gameState.player.avatar}" alt="Profile" class="w-full h-full object-cover rounded-full">`;
            } else {
                currentPhotoElement.textContent = gameState.player.avatar;
            }
            
            // Update current name
            document.getElementById('current-name-display').textContent = gameState.player.playerName;
            
            // Update account info
            document.getElementById('account-username').textContent = gameState.player.username;
            document.getElementById('account-email').textContent = gameState.player.email;
            document.getElementById('account-age-group').textContent = gameState.player.ageGroup;
            
            const joinDate = gameState.player.joinDate ? new Date(gameState.player.joinDate).toLocaleDateString() : 'Unknown';
            document.getElementById('account-join-date').textContent = joinDate;
            
            // Populate avatar selector
            populateAvatarSelector();
        }

        // Populate Avatar Selector
        function populateAvatarSelector() {
            const avatarSelector = document.getElementById('avatar-selector');
            const avatars = [
                'üë§', 'üßë', 'üë©', 'üßí', 'üë¶', 'üëß', 'üßë‚Äçüéì', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'ü§ì', 
                'üòä', 'üòé', 'ü§ó', 'ü•≥', 'üåü', 'üéØ', 'üöÄ', 'üíé', 'üî•', '‚ö°', 
                'üé™', 'üé®', 'üåà', 'ü¶Ñ', 'üê±', 'üê∂', 'ü¶ä', 'üêº', 'üê∏', 'ü¶ã'
            ];
            
            avatarSelector.innerHTML = avatars.map(avatar => `
                <button class="w-12 h-12 bg-white rounded-lg border-2 border-gray-200 hover:border-blue-500 transition-colors text-2xl flex items-center justify-center ${gameState.player.avatar === avatar ? 'border-blue-500 bg-blue-50' : ''}" onclick="selectAvatar('${avatar}')">
                    ${avatar}
                </button>
            `).join('');
        }

        // Select Avatar
        let selectedAvatar = null;
        function selectAvatar(avatar) {
            selectedAvatar = avatar;
            
            // Update visual selection
            document.querySelectorAll('#avatar-selector button').forEach(btn => {
                btn.classList.remove('border-blue-500', 'bg-blue-50');
                btn.classList.add('border-gray-200');
            });
            
            event.target.classList.remove('border-gray-200');
            event.target.classList.add('border-blue-500', 'bg-blue-50');
            
            // Update preview
            document.getElementById('current-profile-photo').textContent = avatar;
        }

        // Save Profile Photo
        function saveProfilePhoto() {
            const photoUpload = document.getElementById('photo-upload');
            
            if (selectedAvatar) {
                // Save selected avatar
                gameState.player.avatar = selectedAvatar;
                gameState.currentUser.avatar = selectedAvatar;
                
                // Update user in database
                updateUserInDatabase(gameState.currentUser);
                saveGameState();
                updateAuthUI();
                
                showSuccess('Profile photo updated successfully! üì∏');
                selectedAvatar = null;
                
            } else if (photoUpload.files && photoUpload.files[0]) {
                // Handle custom photo upload
                const file = photoUpload.files[0];
                
                // Check file size (2MB limit)
                if (file.size > 2 * 1024 * 1024) {
                    showError('File size too large! Please choose a file under 2MB.');
                    return;
                }
                
                // Check file type
                if (!file.type.startsWith('image/')) {
                    showError('Please select a valid image file!');
                    return;
                }
                
                // Read and convert to base64
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64Image = e.target.result;
                    
                    // Save custom photo
                    gameState.player.avatar = base64Image;
                    gameState.player.customPhoto = true;
                    gameState.currentUser.avatar = base64Image;
                    gameState.currentUser.customPhoto = true;
                    
                    // Update user in database
                    updateUserInDatabase(gameState.currentUser);
                    saveGameState();
                    updateAuthUI();
                    
                    // Update preview
                    const photoElement = document.getElementById('current-profile-photo');
                    photoElement.innerHTML = `<img src="${base64Image}" alt="Profile" class="w-full h-full object-cover rounded-full">`;
                    
                    showSuccess('Custom photo uploaded successfully! üéâ');
                    
                    // Clear file input
                    photoUpload.value = '';
                };
                reader.readAsDataURL(file);
                
            } else {
                showError('Please select an avatar or upload a photo!');
            }
        }

        // Handle Change Name Form
        function handleChangeNameForm() {
            document.getElementById('change-name-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const newName = document.getElementById('new-name-input').value.trim();
                
                if (!newName) {
                    showError('Please enter a new name!');
                    return;
                }
                
                if (newName.length < 2) {
                    showError('Name must be at least 2 characters long!');
                    return;
                }
                
                if (newName.length > 50) {
                    showError('Name must be less than 50 characters!');
                    return;
                }
                
                if (newName === gameState.player.playerName) {
                    showError('New name is the same as current name!');
                    return;
                }
                
                // Update name
                gameState.player.playerName = newName;
                gameState.currentUser.playerName = newName;
                
                // Update user in database
                updateUserInDatabase(gameState.currentUser);
                saveGameState();
                updateAuthUI();
                
                // Update display
                document.getElementById('current-name-display').textContent = newName;
                document.getElementById('new-name-input').value = '';
                
                showSuccess(`Name updated to "${newName}" successfully! ‚úèÔ∏è`);
            });
        }

        // Handle Change Password Form
        function handleChangePasswordForm() {
            document.getElementById('change-password-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const currentPassword = document.getElementById('current-password-input').value;
                const newPassword = document.getElementById('new-password-input').value;
                const confirmPassword = document.getElementById('confirm-new-password-input').value;
                
                // Validate current password
                if (currentPassword !== gameState.currentUser.password) {
                    showError('Current password is incorrect!');
                    return;
                }
                
                // Validate new password
                if (!newPassword) {
                    showError('Please enter a new password!');
                    return;
                }
                
                if (newPassword.length < 6) {
                    showError('New password must be at least 6 characters long!');
                    return;
                }
                
                if (newPassword === currentPassword) {
                    showError('New password must be different from current password!');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showError('New passwords do not match!');
                    return;
                }
                
                // Update password
                gameState.currentUser.password = newPassword;
                
                // Update user in database
                updateUserInDatabase(gameState.currentUser);
                
                // Clear form
                document.getElementById('current-password-input').value = '';
                document.getElementById('new-password-input').value = '';
                document.getElementById('confirm-new-password-input').value = '';
                
                showSuccess('Password updated successfully! üîê');
            });
        }

        // Reset All Progress
        function resetAllProgress() {
            if (!gameState.isLoggedIn) {
                showError('Please login first!');
                return;
            }
            
            const confirmText = 'RESET';
            const userInput = prompt(`‚ö†Ô∏è WARNING: This will delete ALL your game progress, coins, achievements, and statistics!\n\nThis action CANNOT be undone!\n\nType "${confirmText}" to confirm:`);
            
            if (userInput === confirmText) {
                // Reset player data but keep account info
                gameState.player = {
                    ...gameState.player,
                    coins: 100, // Welcome bonus
                    level: 1,
                    streak: 0,
                    gamesPlayed: 0,
                    correctAnswers: 0,
                    totalQuestions: 0,
                    achievements: ['first_steps'], // Welcome achievement
                    recentActivity: [],
                    totalScore: 0,
                    bestScore: 0
                };
                
                saveGameState();
                updateUI();
                
                showSuccess('All progress has been reset! You start fresh with welcome bonus. üîÑ');
                closeModal('settings-modal');
                showSection('home');
            } else if (userInput !== null) {
                showError('Reset cancelled - confirmation text did not match.');
            }
        }

        // Delete Account
        function deleteAccount() {
            if (!gameState.isLoggedIn) {
                showError('Please login first!');
                return;
            }
            
            const confirmText = 'DELETE';
            const userInput = prompt(`üö® DANGER: This will permanently DELETE your entire account!\n\n‚Ä¢ All your progress will be lost\n‚Ä¢ Your username will be freed up\n‚Ä¢ This action CANNOT be undone\n\nType "${confirmText}" to confirm account deletion:`);
            
            if (userInput === confirmText) {
                const username = gameState.currentUser.username;
                const playerName = gameState.player.playerName;
                
                // Delete user from database
                deleteUserFromDatabase(username);
                
                // Logout user
                gameState.isLoggedIn = false;
                gameState.currentUser = null;
                gameState.player = {
                    coins: 0,
                    level: 1,
                    streak: 0,
                    gamesPlayed: 0,
                    correctAnswers: 0,
                    totalQuestions: 0,
                    achievements: [],
                    recentActivity: [],
                    totalScore: 0,
                    bestScore: 0,
                    playerName: 'Guest',
                    email: '',
                    username: '',
                    avatar: 'üë§',
                    ageGroup: '',
                    joinDate: null
                };
                
                // Clear remember me
                localStorage.removeItem('eduGameRememberUser');
                
                // Update UI
                updateAuthUI();
                closeModal('settings-modal');
                showSection('home');
                
                showSuccess(`Account "${playerName}" has been permanently deleted. üóëÔ∏è`);
            } else if (userInput !== null) {
                showError('Account deletion cancelled - confirmation text did not match.');
            }
        }

        // Update System Functions
        
        // Check for Updates
        async function checkForUpdates(isManual = false) {
            if (updateState.isChecking) return;
            
            updateState.isChecking = true;
            
            if (isManual) {
                const checkBtn = document.getElementById('check-updates-btn');
                checkBtn.innerHTML = '<span class="text-xl">‚è≥</span><span>Checking...</span>';
                checkBtn.disabled = true;
            }
            
            try {
                // In production, replace this with actual API call
                // const response = await fetch(APP_CONFIG.updateCheckUrl);
                // const updateData = await response.json();
                
                // For demo, simulate API call
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Check if update is available
                const currentVersion = APP_CONFIG.currentVersion;
                const latestVersion = MOCK_UPDATE_DATA.version;
                
                if (isVersionNewer(latestVersion, currentVersion)) {
                    updateState.isUpdateAvailable = true;
                    updateState.updateData = MOCK_UPDATE_DATA;
                    
                    // Save update check time
                    APP_CONFIG.lastUpdateCheck = Date.now();
                    localStorage.setItem('eduGameUpdateCheck', JSON.stringify({
                        lastCheck: APP_CONFIG.lastUpdateCheck,
                        availableVersion: latestVersion
                    }));
                    
                    if (isManual) {
                        showUpdateDetails();
                    } else {
                        showUpdateNotification();
                    }
                } else {
                    if (isManual) {
                        showSuccess('üéâ You\'re running the latest version!');
                    }
                }
                
                updateLastCheckDisplay();
                
            } catch (error) {
                console.error('Update check failed:', error);
                if (isManual) {
                    showError('Failed to check for updates. Please try again later.');
                }
            } finally {
                updateState.isChecking = false;
                
                if (isManual) {
                    const checkBtn = document.getElementById('check-updates-btn');
                    checkBtn.innerHTML = '<span class="text-xl">üîÑ</span><span>Check for Updates</span>';
                    checkBtn.disabled = false;
                }
            }
        }
        
        // Compare version numbers
        function isVersionNewer(newVersion, currentVersion) {
            const newParts = newVersion.split('.').map(Number);
            const currentParts = currentVersion.split('.').map(Number);
            
            for (let i = 0; i < Math.max(newParts.length, currentParts.length); i++) {
                const newPart = newParts[i] || 0;
                const currentPart = currentParts[i] || 0;
                
                if (newPart > currentPart) return true;
                if (newPart < currentPart) return false;
            }
            
            return false;
        }
        
        // Show Update Notification
        function showUpdateNotification() {
            const notification = document.getElementById('update-notification');
            const versionInfo = document.getElementById('update-version-info');
            const mainContent = document.getElementById('main-content');
            
            versionInfo.textContent = `Version ${updateState.updateData.version} with exciting new features`;
            
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.remove('-translate-y-full');
                mainContent.style.paddingTop = '80px';
            }, 100);
        }
        
        // Dismiss Update Notification
        function dismissUpdateNotification() {
            const notification = document.getElementById('update-notification');
            const mainContent = document.getElementById('main-content');
            
            notification.classList.add('-translate-y-full');
            mainContent.style.paddingTop = '32px';
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 500);
            
            // Set reminder for later
            APP_CONFIG.lastUpdateReminder = Date.now();
            localStorage.setItem('eduGameUpdateReminder', Date.now().toString());
        }
        
        // Show Update Details
        function showUpdateDetails() {
            const modal = document.getElementById('update-details-modal');
            const updateData = updateState.updateData;
            
            // Update version displays
            document.getElementById('current-version-display').textContent = APP_CONFIG.currentVersion;
            document.getElementById('new-version-display').textContent = updateData.version;
            document.getElementById('release-date-display').textContent = new Date(updateData.releaseDate).toLocaleDateString();
            document.getElementById('file-size-display').textContent = updateData.fileSize;
            
            // Populate features list
            const featuresList = document.getElementById('new-features-list');
            featuresList.innerHTML = updateData.features.map(feature => `
                <div class="bg-white rounded-lg p-3 flex items-center space-x-3">
                    <div class="text-green-600 font-bold">‚úì</div>
                    <div class="text-green-800">${feature}</div>
                </div>
            `).join('');
            
            // Populate bug fixes list
            const bugFixesList = document.getElementById('bug-fixes-list');
            bugFixesList.innerHTML = updateData.bugFixes.map(fix => `
                <div class="bg-white rounded-lg p-3 flex items-center space-x-3">
                    <div class="text-blue-600 font-bold">üîß</div>
                    <div class="text-blue-800">${fix}</div>
                </div>
            `).join('');
            
            // Populate improvements list
            const improvementsList = document.getElementById('improvements-list');
            improvementsList.innerHTML = updateData.improvements.map(improvement => `
                <div class="bg-white rounded-lg p-3 flex items-center space-x-3">
                    <div class="text-purple-600 font-bold">‚ö°</div>
                    <div class="text-purple-800">${improvement}</div>
                </div>
            `).join('');
            
            modal.classList.remove('hidden');
        }
        
        // Start Update
        function startUpdate() {
            dismissUpdateNotification();
            startUpdateProcess();
        }
        
        // Start Update from Modal
        function startUpdateFromModal() {
            closeModal('update-details-modal');
            startUpdateProcess();
        }
        
        // Start Update Process
        function startUpdateProcess() {
            updateState.isUpdating = true;
            updateState.updateProgress = 0;
            
            const modal = document.getElementById('update-progress-modal');
            modal.classList.remove('hidden');
            
            // Reset progress UI
            updateProgressUI(0, 'Initializing update...', '‚¨áÔ∏è', 'Preparing to download');
            
            // Start download simulation
            simulateUpdateProcess();
        }
        
        // Simulate Update Process
        function simulateUpdateProcess() {
            const steps = [
                { progress: 10, text: 'Connecting to server...', emoji: 'üåê', step: 'Connecting' },
                { progress: 25, text: 'Downloading update...', emoji: '‚¨áÔ∏è', step: 'Downloading' },
                { progress: 45, text: 'Downloading assets...', emoji: 'üì¶', step: 'Downloading' },
                { progress: 65, text: 'Verifying download...', emoji: 'üîç', step: 'Verifying' },
                { progress: 75, text: 'Installing update...', emoji: '‚öôÔ∏è', step: 'Installing' },
                { progress: 85, text: 'Updating files...', emoji: 'üìÅ', step: 'Installing' },
                { progress: 95, text: 'Finalizing installation...', emoji: '‚ú®', step: 'Finalizing' },
                { progress: 100, text: 'Update complete!', emoji: 'üéâ', step: 'Complete' }
            ];
            
            let currentStep = 0;
            
            const updateInterval = setInterval(() => {
                if (currentStep < steps.length && updateState.isUpdating) {
                    const step = steps[currentStep];
                    updateProgressUI(step.progress, step.text, step.emoji, step.step);
                    
                    // Update step indicators
                    if (step.progress >= 25) {
                        document.getElementById('step-download').classList.remove('bg-gray-300', 'text-gray-600');
                        document.getElementById('step-download').classList.add('bg-green-500', 'text-white');
                        document.getElementById('step-download').innerHTML = '‚úì';
                    }
                    if (step.progress >= 75) {
                        document.getElementById('step-install').classList.remove('bg-gray-300', 'text-gray-600');
                        document.getElementById('step-install').classList.add('bg-green-500', 'text-white');
                        document.getElementById('step-install').innerHTML = '‚úì';
                        
                        // Hide cancel button during installation
                        document.getElementById('cancel-update-btn').style.display = 'none';
                    }
                    if (step.progress >= 100) {
                        document.getElementById('step-restart').classList.remove('bg-gray-300', 'text-gray-600');
                        document.getElementById('step-restart').classList.add('bg-green-500', 'text-white');
                        document.getElementById('step-restart').innerHTML = '‚úì';
                        
                        // Complete update
                        setTimeout(() => {
                            completeUpdate();
                        }, 1000);
                        
                        clearInterval(updateInterval);
                    }
                    
                    currentStep++;
                } else if (!updateState.isUpdating) {
                    clearInterval(updateInterval);
                }
            }, 800);
        }
        
        // Update Progress UI
        function updateProgressUI(progress, text, emoji, step) {
            updateState.updateProgress = progress;
            
            document.getElementById('update-progress-bar').style.width = progress + '%';
            document.getElementById('update-progress-text').textContent = progress + '%';
            document.getElementById('update-step-text').textContent = text;
            document.getElementById('update-progress-emoji').textContent = emoji;
            
            // Update title and description based on progress
            const titleElement = document.getElementById('update-progress-title');
            const descElement = document.getElementById('update-progress-description');
            
            if (progress < 25) {
                titleElement.textContent = 'Preparing Update...';
                descElement.textContent = 'Getting ready to download the latest version';
            } else if (progress < 75) {
                titleElement.textContent = 'Downloading Update...';
                descElement.textContent = 'Please wait while we download the new version';
            } else if (progress < 100) {
                titleElement.textContent = 'Installing Update...';
                descElement.textContent = 'Installing the new version and updating files';
            } else {
                titleElement.textContent = 'Update Complete!';
                descElement.textContent = 'Successfully updated to the latest version';
            }
        }
        
        // Cancel Update
        function cancelUpdate() {
            if (updateState.updateProgress >= 75) {
                showError('Cannot cancel update during installation!');
                return;
            }
            
            if (confirm('Are you sure you want to cancel the update?')) {
                updateState.isUpdating = false;
                closeModal('update-progress-modal');
                showError('Update cancelled by user.');
            }
        }
        
        // Complete Update
        function completeUpdate() {
            // Update app version
            APP_CONFIG.currentVersion = updateState.updateData.version;
            localStorage.setItem('eduGameAppVersion', APP_CONFIG.currentVersion);
            
            // Clear update state
            updateState.isUpdateAvailable = false;
            updateState.updateData = null;
            updateState.isUpdating = false;
            
            // Remove update check data
            localStorage.removeItem('eduGameUpdateCheck');
            localStorage.removeItem('eduGameUpdateReminder');
            
            // Update version displays
            document.getElementById('footer-version-display').textContent = 'v' + APP_CONFIG.currentVersion;
            
            // Close progress modal
            closeModal('update-progress-modal');
            
            // Show success message
            showUpdateCompleteNotification();
        }
        
        // Show Update Complete Notification
        function showUpdateCompleteNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-gradient-to-r from-green-500 to-teal-500 text-white p-6 rounded-lg shadow-lg z-50 bounce-scale max-w-sm';
            notification.innerHTML = `
                <div class="text-center">
                    <div class="text-4xl mb-3 celebration">üéâ</div>
                    <div class="font-bold text-lg mb-2">Update Successful!</div>
                    <div class="text-sm opacity-90 mb-4">
                        Updated to version ${APP_CONFIG.currentVersion}<br>
                        Enjoy the new features!
                    </div>
                    <button class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-semibold transition-colors" onclick="this.parentElement.parentElement.remove()">
                        ‚ú® Awesome!
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 8 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 8000);
        }
        
        // Remind Later
        function remindLater() {
            closeModal('update-details-modal');
            APP_CONFIG.lastUpdateReminder = Date.now();
            localStorage.setItem('eduGameUpdateReminder', Date.now().toString());
            showSuccess('We\'ll remind you about the update in 6 hours! ‚è∞');
        }
        
        // Manual Update Check
        function manualUpdateCheck() {
            checkForUpdates(true);
        }
        
        // Update Last Check Display
        function updateLastCheckDisplay() {
            const lastCheckElement = document.getElementById('last-check-display');
            if (APP_CONFIG.lastUpdateCheck) {
                const lastCheck = new Date(APP_CONFIG.lastUpdateCheck);
                const now = new Date();
                const diffHours = Math.floor((now - lastCheck) / (1000 * 60 * 60));
                
                if (diffHours < 1) {
                    lastCheckElement.textContent = 'Last checked: Just now';
                } else if (diffHours < 24) {
                    lastCheckElement.textContent = `Last checked: ${diffHours} hours ago`;
                } else {
                    const diffDays = Math.floor(diffHours / 24);
                    lastCheckElement.textContent = `Last checked: ${diffDays} days ago`;
                }
            } else {
                lastCheckElement.textContent = 'Last checked: Never';
            }
        }
        
        // Load Update State
        function loadUpdateState() {
            // Load saved version
            const savedVersion = localStorage.getItem('eduGameAppVersion');
            if (savedVersion) {
                APP_CONFIG.currentVersion = savedVersion;
            }
            
            // Load last update check
            const updateCheckData = localStorage.getItem('eduGameUpdateCheck');
            if (updateCheckData) {
                const checkData = JSON.parse(updateCheckData);
                APP_CONFIG.lastUpdateCheck = checkData.lastCheck;
            }
            
            // Load last reminder
            const lastReminder = localStorage.getItem('eduGameUpdateReminder');
            if (lastReminder) {
                APP_CONFIG.lastUpdateReminder = parseInt(lastReminder);
            }
            
            // Update version display
            document.getElementById('footer-version-display').textContent = 'v' + APP_CONFIG.currentVersion;
            updateLastCheckDisplay();
        }
        
        // Auto Update Check
        function autoUpdateCheck() {
            const now = Date.now();
            
            // Check if we should check for updates
            if (!APP_CONFIG.lastUpdateCheck || 
                (now - APP_CONFIG.lastUpdateCheck) > APP_CONFIG.updateCheckInterval) {
                
                // Check if we should show reminder
                if (!APP_CONFIG.lastUpdateReminder || 
                    (now - APP_CONFIG.lastUpdateReminder) > APP_CONFIG.reminderInterval) {
                    
                    setTimeout(() => {
                        checkForUpdates(false);
                    }, 3000); // Check after 3 seconds of app load
                }
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            checkRememberedUser();
            loadGameState();
            updateAuthUI();
            addEnterKeySupport();
            
            // Initialize update system
            loadUpdateState();
            autoUpdateCheck();
            
            // Initialize settings form handlers
            handleChangeNameForm();
            handleChangePasswordForm();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                if (gameState.currentSection === 'gameplay' && gameState.currentGame.isActive) {
                    const key = event.key;
                    if (key >= '1' && key <= '4') {
                        const index = parseInt(key) - 1;
                        selectAnswer(index);
                    }
                }
                
                // Close modals with Escape key
                if (event.key === 'Escape') {
                    const modals = ['login-modal', 'register-modal', 'forgot-password-modal', 'welcome-modal', 'user-manager-modal', 'switch-user-modal', 'device-info-modal', 'settings-modal'];
                    modals.forEach(modalId => {
                        const modal = document.getElementById(modalId);
                        if (modal && !modal.classList.contains('hidden')) {
                            closeModal(modalId);
                        }
                    });
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96d7ba0627ce6eb9',t:'MTc1NDkxNTI0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
